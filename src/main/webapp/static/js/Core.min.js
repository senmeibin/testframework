SysCmn.ClientIDList=[];SysCmn.TimeSelect=[];SysCmn.AutoComplete=[];(function(a){a.fn.exist=function(){if(a(this).length>=1){return true}return false}})(jQuery);SysCmn.Core=Class.create();SysCmn.Core.prototype={initialize:function(){this.initCommonProperty();this.eventList={};this.domIDIndex=1;this.calendarFormat="YYYY/MM/DD";this.initCalendarFlag=true;this.showValidatorPopupMessage=true;this.deleteMethod="delete";this.showProcessingMessage=true},showHelp:function(){var a=SysApp.Cmn.HelpIns;if(this.isNull(a)){this.showErrorMessage("帮助功能暂未开放，请与系统管理员联系。");return}var b="pageInstance="+a.pageInstance+"&settingType="+a.settingType;if(this.isNotEmpty(a.pageMode)){b="pageInstance="+a.pageInstance+"_"+a.pageMode+"&settingType="+a.settingType}AjaxIns.sendPOST(a.controller+"getHelpDetail",this.showHelpCallback.bind(this),b)},showHelpCallback:function(a){if($M.isAjaxFail(a.responseText)){return}SysApp.Cmn.HelpIns.inputEntity=JsonUtility.Parse(a.responseText);SysApp.Cmn.HelpIns.initInputForm(SysApp.Cmn.HelpIns.inputEntity);SysApp.Cmn.HelpIns.show()},initCommonProperty:function(){this.popupSwitchPage=false;this.dom={};this.editor={};this.callback=function(){};this.inputEntity={};this.searchEntity={};this.exportMethod="export";this.autoHideFlashMessage=false;this.popupPosition="center";this.deleteConfirmMessage="<label style='color:#FF0000;'>数据删除后将不能恢复，确定要删除吗？</label>";this.isSaveSuccessAfterRefreshList=true;this.isDeleteSuccessAfterRefreshList=true;if(this.isEmpty(window.ShowSaveDataSuccessMessage)){this.showSaveDataSuccessMessage=true}else{this.showSaveDataSuccessMessage=window.ShowSaveDataSuccessMessage}this.windowState="normal";this.windowProperty={}},bindEvent:function(e,b,d,f){if(this.isEmpty(f)){f=false}var a=this.getDom(e);if(this.isNotNull(a)){if(this.isEmpty(a.id)){a.id=this.getClientID()+"_randomDomID_"+this.domIDIndex;this.domIDIndex++}var c=a.id+b+d;if(this.isEmpty(this.eventList[c])){if(f==false){this.eventList[c]=1}Event.observe(a,b,d)}}},initEnterSearch:function(){var a=this;$(this.getMainContentClassName()).each(function(){console.log(a.getMainFormID()+"画面回车检索事件绑定。");Event.observe(this,"keydown",a.enterSearch.bind(a))})},enterSearch:function(){var a=$M.getEvent();if(this.isNull(a)){console.log("event为空，回车检索处理中止。");return}var b=$(Event.element(a)).data("enter-search");if(this.isNull(b)){b=true}if(b==false){return}if(a.keyCode==13||a.which==13){if(this.isNotEmpty(this.dom.btnSearch)){console.log(this.getMainFormID()+"画面执行回车检索处理。");this.onClick_Search()}else{console.log(this.getMainFormID()+"画面无检索按钮，处理跳过。")}}},initSelect2Required:function(){setTimeout(this.delayInitSelect2Required.bind(this),100)},delayInitSelect2Required:function(){$(".select2-container",".select2-required").each(function(){$(this).addClass("required")})},isPopupMode:function(){return this.isNotNull(this.getFrame())},getFrame:function(){return $E(this.dom.ctlFrame)},getUploadifyUploaderURL:function(){return window.contextPath+"/cmn/fileupload/uploading"},initCore:function(){if(!$M.isEmpty(this.groupSelectInstance)){this.groupSelectInstance.onClick_Ok_Callback=this.groupSelectCallback.bind(this)}if(!$M.isEmpty(this.userSelectInstance)){this.userSelectInstance.onClick_Ok_Callback=this.userSelectCallback.bind(this)}},initCommonDomIds:function(a){var b=this;$.each(a,function(c,e){if(b.isEmpty(b.dom[e])){var d=[e,"_"+e];$.each(d,function(f,g){if(!b.isNull($E(b.clientID+g))){b.dom[e]=b.clientID+g}})}})},isConditionChanged:function(a,b){if(JsonUtility.ToJSON(a)!=JsonUtility.ToJSON(b)){this.showMessage("查询条件被修改，请重新查询。",MSG_TYPE_WARNING);return true}return false},getSearchCommonParams:function(a){return a.getConditionJson()+"&conditionJson="+JsonUtility.ToJSON(this.searchEntity)},getMainContentClassName:function(){return"."+this.getClientID()+"-MainContent"},getClientID:function(){return this.clientID},getMainFormID:function(){return"#"+this.getClientID()+"_MainForm"},clearValue:function(a){if($(a).data("allow-clear")==false){return true}else{if($(a).data("allow-clear")==true){if(a.type=="select-one"||a.type=="select-multiple"){a.selectedIndex=-1;this.initSelect2Selected()}else{if(a.type=="radio"||a.type=="checkbox"){a.checked=false}else{a.value=""}}return true}}return false},clearForm:function(a){if(this.isNull(a)){a=true}var b=this;$("input[type='text'], input[type='number'], input[type='password'], input[type='file'], select, textarea, input[type='checkbox'], input[type='radio']",this.getMainFormID()).each(function(){if(b.clearValue(this)){return}if(a||this.disabled==false){if(this.type=="select-one"||this.type=="select-multiple"){this.selectedIndex=-1;b.initSelect2Selected()}else{if(this.type=="checkbox"||this.type=="radio"){this.checked=false}else{if(this.type=="file"){this.outerHTML=this.outerHTML}else{this.value=""}}}}});$("input[type='hidden']",this.getMainFormID()).each(function(){b.clearValue(this)})},initSelect2Selected:function(){try{$("select[select2]").select2()}catch(a){console.log("select2插件相关js未导入。")}},clearInputEntity:function(){this.inputEntity={}},clearSearchEntity:function(){this.searchEntity={}},onClick_Clear:function(){if(this.isFunction(this.clearFormBefore)){this.clearFormBefore()}this.clearForm(false);if(this.isFunction(this.clearFormAfter)){this.clearFormAfter()}this.clearZtreeNodes()},clearZtreeNodes:function(){var thisObj=this;$(".combo-tree-container",this.getMainFormID()).each(function(){$("ul",this).each(function(){if(thisObj.isNotEmpty(this.id)&&this.id.lastIndexOf("Tree")>0){var treeInstance=eval("thisObj."+this.id.replaceAll(thisObj.getClientID()+"_","").replaceAll("Tree","ComboTree"));treeInstance.checkAllNodes(false);return false}})})},onClick_Close:function(){if(this.isFunction(this.closePopupBefore)){this.closePopupBefore()}this.hide();if(this.isFunction(this.closePopupAfter)){this.closePopupAfter()}},hide:function(){if(!this.isPopupMode()){return}if(this.isInputPage){this.clearForm()}if(this.popupSwitchPage==true&&this.isNotNull(this.parentFrame)){this.switchPage(false)}else{SysCmn.EstopLayer.hide(this.getFrame());$(this.getFrame()).fadeOut()}if(this.windowState=="max"){this.onClick_Maximization()}if(this.isFunction(this.hideCallback)){this.hideCallback()}},getSearchEntity:function(){if(this.isNull(this.getClientID())){this.showMessage("Js Class ClientID is not defined.",MSG_TYPE_WARNING)}var b={};b["includeGroupQuery$ignore_search"]=this.includeGroupQuery;b["includeOrderQuery$ignore_search"]=this.includeOrderQuery;var a=this.getClientID();$("input[type='text'], input[type='number'], input[type='hidden'], input[type='checkbox'], select, textarea",this.getMainFormID()).each(function(){if($M.isEmpty(this.id)||$(this).data("ignore-search")==true){return}var c=SysCmn.CoreUtility.getAliasTableName(this);var d=SysCmn.CoreUtility.getCamelFieldFlag(this);var f=$(this).data("search-mode");if($M.isEmpty(f)){f=""}if(SysCmn.CoreUtility.isDateField(this)){b[c+SysCmn.CoreUtility.getFieldName(a,this.id)+f]=this.value}else{if($M.isEmpty(f)){if(this.type=="select-one"||this.type=="checkbox"){f=""}else{if(this.type=="select-multiple"){f="$array_search"}else{f="$partial_search"}}}if(f!=""&&f.indexOf("$")==-1){f="$"+f}if(this.id.indexOf("$")>0){f=""}if(f=="$equal_search"){f=""}var e=c+SysCmn.CoreUtility.getFieldName(a,this.id)+f+d;if(this.type=="checkbox"||this.type=="radio"){var g=this.value;if($M.isEmpty(g)||g=="on"){g=1}b[e]=(this.checked?g:"")}else{var g=$(this).val();if($M.isEmpty(g)){g=""}if(g instanceof Array){g=g.join(",")}b[e]=$M.trim(g)}}});return b},initInputForm:function(a){this._initFormByEntity(a)},initSearchForm:function(a){this._initFormByEntity(a)},_initFormByEntity:function(entity,prefix){for(var key in entity){if(typeof(entity[key])==="object"){this._initFormByEntity(entity[key],key);continue}var domId=key;if(this.isNotEmpty(prefix)){domId=prefix+"."+key}try{var obj=$E(this.getClientID()+"_"+domId);if(SysCmn.CoreUtility.isDateField(obj)&&!SysCmn.CoreUtility.isLabel(obj)){$(obj).css("width","100px")}if(this._initDomValue(obj,entity,key)){continue}}catch(e){alert(domId+"\t"+e)}try{var obj=$E(eval("this.dom")[domId]);this._initDomValue(obj,entity,key)}catch(e){alert(domId+"\t"+e)}}},_initDomValue:function(c,a,b){if(c!=null&&(c.type=="checkbox"||c.type=="radio")){c.checked=(a[b]==1);return true}else{if(SysCmn.CoreUtility.setValue(c,a[b])){return true}}return false},disableInput:function(a,b){var c=this;$("input[type='text'], input[type='number'], input[type='button'], input[type='checkbox'], input[type='radio'], button, textarea, select, img, a",a).each(function(){c.disabledDom(this,b)})},disabledDom:function(b,a){if(typeof b=="string"){b=this.getDom(b)}if(this.isNull(b)){return}if(this.isNotEmpty(b.id)){if(b.id.indexOf("_btnClose")>0||b.id.indexOf("_btnBack")>0){b.disabled=false;return}}if(!this.isAllowDisabled(b)){return}b.disabled=a},isAllowDisabled:function(b){var a=$(b).data("allow-disabled");if(this.isEmpty(a)||a==true){return true}return false},createOption:function(l,h,o,c,k,a){l=this.getId(l);if(this.isEmpty(a)){a="-全部-"}else{var n=this.$(l).data("title");if(this.isNotEmpty(n)){a+=n}}var b=this.$(l).data("blank-text");if(this.isNotEmpty(b)){a=b}$E(l).innerHTML="";var m="";if(this.isNotEmpty(this.$(l).data("need-blank"))){k=this.$(l).data("need-blank")}if(k==true||k=="true"){m+="<option value=''>"+a+"</option>"}if(this.isNull(h)){$($E(l)).append(m);return}if(this.isEmpty(o)&&this.isEmpty(c)){$.each(h,function(i,j){m+="<option value='"+i+"'>"+j+"</option>"})}else{if(h.length>0){var d=c.split("|");for(var f=0;f<h.length;f++){var e="";for(var g=0;g<d.length;g++){if(d[g]==""){continue}if(e==""){e=h[f][d[g]]}else{e+="|"+h[f][d[g]]}}m+="<option value='"+h[f][o]+"'>"+e+"</option>"}}}$($E(l)).append(m)},appendOption:function(a,c,b){$(this.getDom(a)).append("<option value='"+c+"'>"+b+"</option>")},getSelectedIds:function(a,d){var f=a.getSelectedRows();var c=[];for(var b=0;b<f.length;b++){var e=f[b];c.push(this.getPkValue(e,d))}if(a.selectedIndex!=-1){c.push(this.getPkValue(a.getSelectedRow(),d))}return c.toString()},getPkValue:function(a,c){if(this.isNull(a)){return""}if(typeof c=="string"){return a[c]}else{var d="";for(var b=0;b<c.length;b++){if(b==0){d+=a[c[b]]}else{d+="\n"+a[c[b]]}}return d}},checkData:function(){if(this.validateForm()==false){return false}return true},validateForm:function(){if(this.isFunction(this.validateFormBefore)){if(!this.validateFormBefore()){return false}}if(this.isFunction(this.initValidator)&&this.isNotNull(this.validator)){if(!this.validator.form()){return false}}if(this.isFunction(this.validateFormAfter)){if(!this.validateFormAfter()){return false}}return true},isFunction:function(a){return(typeof a=="function")},deleteData:function(a){if(!this.isFunction(this.getPrimaryKey)){alert("请在子类中定义getPrimaryKey方法。");return}if($M.isEmpty(a)&&this.isNotNull(this.inputEntity)){a=this.getPkValue(this.inputEntity,this.getPrimaryKey())}if(this.isNull(a)){a=this.getSelectedIds(this.datagrid,this.getPrimaryKey())}var b="uid="+a;if(this.isFunction(this.customDeleteDataParams)){b+=this.customDeleteDataParams()}this.showProcessing(false);AjaxIns.sendPOST(this.controller+this.deleteMethod,this.deleteDataCallback.bind(this),b)},deleteDataCallback:function(b){if($M.isAjaxFail(b.responseText)){return}var a=JsonUtility.Parse(b.responseText);if(this.isFunction(this.customDeleteDataCallback)){this.customDeleteDataCallback(a)}if(a.result>0){if(this.showSaveDataSuccessMessage){if(this.isDeleteSuccessAfterRefreshList){this.showMessage(a.message,MSG_TYPE_INFO,this.refreshList.bind(this))}else{this.showMessage(a.message,MSG_TYPE_INFO)}}else{if(this.isDeleteSuccessAfterRefreshList){this.refreshList()}else{this.hideMessage()}}}else{this.showMessage(a.message,MSG_TYPE_ERROR)}},auditData:function(a,b){if(!this.isFunction(this.getPrimaryKey)){alert("请在子类中定义getPrimaryKey方法。");return}if($M.isEmpty(b)&&this.isNotNull(this.inputEntity)){b=this.getPkValue(this.inputEntity,this.getPrimaryKey())}if(this.isNull(b)){b=this.getSelectedIds(this.datagrid,this.getPrimaryKey())}var c="uid="+b+"&audit_type="+a;if(this.isFunction(this.customRequestParams)){c+="&"+this.customRequestParams()}this.showProcessing(false);AjaxIns.sendPOST(this.controller,this.auditDataCallback.bind(this),c,"Audit")},auditDataCallback:function(b){if($M.isAjaxFail(b.responseText)){return}var a=JsonUtility.Parse(b.responseText);if(this.isFunction(this.customAuditDataCallback)){this.customAuditDataCallback(a)}if(a.result>0){this.showMessage(a.message,MSG_TYPE_INFO,this.refreshList.bind(this))}else{this.showMessage(a.message,MSG_TYPE_ERROR)}},output:function(a){this.searchEntity=this.getSearchCondition();if(this.isFunction(this.customSearchEntity)){this.customSearchEntity()}if(this.isFunction(this.customExportColList)){a=this.customExportColList()}var k="";if(this.isFunction(this.customRequestParams)){if(this.isNotEmpty(this.customRequestParams())){k="?"+this.customRequestParams()}}var d=$("<form>");d.attr("style","display:none");d.attr("target","_blank");d.attr("method","post");d.attr("action",this.controller+this.exportMethod+k);var h=$("<input>");h.attr("type","hidden");h.attr("name","conditionJson");h.attr("value",JsonUtility.ToJSON(this.searchEntity));if(this.isEmpty(this.exportFileName)){this.exportFileName=this.getClientID()}var c=$("<input>");c.attr("type","hidden");c.attr("name","fileName");c.attr("value",this.exportFileName);var g=$("<input>");g.attr("type","hidden");g.attr("name","pagerJson");var j="";if(this.datagrid!=null){j=this.datagrid.getConditionString()}g.attr("value",j);var f=$("<input>");f.attr("type","hidden");f.attr("name","colList");if(this.isNotNull(a)){f.attr("value",JsonUtility.ToJSON(a));var b=$("<input>");b.attr("type","hidden");b.attr("name","exportCustomColList");b.attr("value","true");d.append(b)}else{f.attr("value",JsonUtility.ToJSON(this.colList))}var e=$("<input>");e.attr("type","hidden");e.attr("name","allColList");e.attr("value",JsonUtility.ToJSON(this.allColList));var i=$("<input>");i.attr("type","hidden");i.attr("name","pageInstance");i.attr("value",this.selfInstance);$("body").append(d);d.append(h);d.append(c);d.append(g);d.append(f);d.append(e);d.append(i);d.submit();d.remove()},isInteger:function(a){var b=parseInt(this.getValue(a),10);if(isNaN(b)){return false}else{this.setValue(a,b);return true}},isDouble:function(a){var b=parseFloat(this.getValue(a));if(isNaN(b)){return false}else{this.setValue(a,b);return true}},allowInteger:function(a,b){if(this.isInteger(a,b)){return true}a.value="";return false},allowDouble:function(a,b){if(this.isDouble(a,b)){return true}a.value="";return false},inputNumbers:function(a){var c;var b;var d;if(window.event){c=a.keyCode}else{if(a.which){c=a.which}}if(c==undefined){return false}if((c==8)||(c==9)||(c==37)||(c==38)||(c==39)||(c==40)){return true}b=String.fromCharCode(c);d=/\d/;return d.test(b)},inputDoubles:function(a){var c;var b;var d;if(window.event){c=a.keyCode}else{if(a.which){c=a.which}}if(c==undefined){return false}if((c==8)||(c==9)||(c==37)||(c==38)||(c==39)||(c==46)||(c==40)){return true}b=String.fromCharCode(c);d=/\d/;return d.test(b)},initValidateDuplication:function(){var a=this;$(".duplication",this.getMainFormID()).each(function(){Event.observe(this,"blur",a.validateDuplication.bind(a,this))})},validateDuplication:function(a){var c=$(a).data("pk-name");if(this.isEmpty(c)){c="uid"}var e=$(a).data("relation-field-name");var g=a.id.replace(this.getClientID()+"_","");var f=$(a).data("title");var d=$(a).data("record-status-is-active")!=false;if(this.isNull(this.getDom(c))){alert("请设定主键字段的DOM对象。")}if(this.isEmpty(a.value)){return}if(this.isFunction(this.customValidateDuplication)){this.customValidateDuplication();return}var b="&pkName="+c+"&pkValue="+this.getValue(c)+"&targetFieldName="+g+"&targetFieldValue="+a.value+"&targetFieldDesc="+f+"&recordStatusIsActive="+d;if(this.isNotEmpty(e)){b+="&relationFieldName="+e;b+="&relationFieldValue="+this.getValue(e)}AjaxIns.sendPOST(this.controller+"validateDuplication",this.validateDuplicationCallback.bind(this,a),b)},validateDuplicationCallback:function(b,c){if($M.isAjaxFail(c.responseText)){return}var a=JsonUtility.Parse(c.responseText);if(this.isFunction(this.customValidateDuplicationCallback)){this.customValidateDuplicationCallback(a);return}if(a.result==-1){this.showMessage(a.message,MSG_TYPE_WARNING,this.selectDomValue.bind(this,b))}else{SysCmn.CmnMsg.hide(true)}},selectDomValue:function(a){a.select()},resetUIDValue:function(b,a){if(!$M.isEmpty($E(b))){if(!$M.isEmpty($E(a))&&$M.isEmpty($E(a).value)){$E(b).value=""}}},setValue:function(b,c){var a=this.getDom(b);if(this.isNotNull(a)){SysCmn.CoreUtility.setValue(a,c)}},getValue:function(c,b){var a=this.getDom(c,b);if(this.isNotNull(a)){return this._getValue(a)}return null},getText:function(a){return $(this.getDom(a)).find("option:selected").text()},getDom:function(c,b){if(typeof c=="object"){return c}if(this.isEmpty(c)){return null}if(this.isNotEmpty(b)&&b==true){return $E(this.getId(c,b))}var a=$E(this.getClientID()+"_"+c);if(this.isNotNull(a)){return a}a=$E(c);if(this.isNotNull(a)){return a}return null},getId:function(c,b){if(this.isNotEmpty(b)&&b==true){return this.getClientID()+"_"+c}var a=this.getDom(c);if(this.isNull(a)){return null}return a.id},_getValue:function(a){if(this.isNull(a)){return""}if(a.type=="checkbox"||a.type=="radio"){if(a.checked){if(this.isEmpty(a.value)||a.value=="on"){return"1"}return a.value}else{return""}}return String($(a).val())},hideFlashMessage:function(){var a=this;$(".flash-notice").each(function(){setTimeout(a._hideFlashMessage.bind(a),3000)});$(".flash-error").each(function(){setTimeout(a._hideFlashMessage.bind(a),3000)})},_hideFlashMessage:function(){$(".flash-notice").each(function(){$(this).fadeOut(1000)});$(".flash-error").each(function(){$(this).fadeOut(1000)})},initUEditor:function(a,d,c){if(this.isNull($E(a))){a=this.getId(a)}if(this.isNull($E(a))){alert("指定的DOMID不存在("+a+")。");return}if(this.isEmpty(d)){d="100%"}if(this.isEmpty(c)){c="100%"}var b=a.replace(this.getClientID()+"_","");this.editor[b]=UE.getEditor(a,{initialFrameWidth:d,initialFrameHeight:c})},initUMEditor:function(a){if(this.isNull($E(a))){a=this.getId(a)}if(this.isNull($E(a))){alert("指定的DOMID不存在("+a+")。");return}var b=a.replace(this.getClientID()+"_","");this.editor[b]=UM.getEditor(this.getDom(a))},switchPage:function(a){if(a){if(this.isNotEmpty($(this.getFrame()).data("page-title"))){$(this.parentFrame).data("parent-frame-title",$("title").html());$("title").html(window.PortalName+" - "+$(this.getFrame()).data("page-title"))}$(this.parentFrame).data("scroll-top",$(document).scrollTop());this.displayDom(this.parentFrame,false);this.displayDom(this.getFrame(),true);$(document).scrollTop(0)}else{this.displayDom(this.parentFrame,true);this.displayDom(this.getFrame(),false);$(document).scrollTop($(this.parentFrame).data("scroll-top"));if(this.isNotEmpty($(this.parentFrame).data("parent-frame-title"))){$("title").html($(this.parentFrame).data("parent-frame-title"))}}},initDomPlaceHolder:function(){var a=this;$("input[type='text'], input[type='number'], input[type='password'], textarea",this.getMainFormID()).each(function(){if(a.isEmpty($(this).data("title"))){return}if(a.isEmpty($(this).attr("placeholder"))){$(this).attr("placeholder","请输入"+$(this).data("title"))}})},initDomName:function(){var a=this;$("input[type='text'], input[type='number'], input[type='password'], input[type='hidden'], textarea, select",this.getMainFormID()).each(function(){if(a.isEmpty($(this).attr("name"))){$(this).attr("name",this.id)}})},containOtherClientID:function(b){var c=this;var a=false;$.each(SysCmn.ClientIDList,function(d,e){if(e!=c.clientID&&b.indexOf(e)==0){console.log("DOM对象（"+b+"）中包含其他ClientID（"+e+"），请确认JSP页面的ClientID-MainContent是否嵌套设置。");a=true;return false}});return a},initDomId:function(){var a=this;$("form, input, button, textarea, select, div, h1, h2, h3, h4, h5, h6, label, span, ul, li, i",this.getMainContentClassName()).each(function(){if(a.containOtherClientID(this.id)){return}if($(this).data("client-id")===false){return}if(!a.isEmpty(this.id)&&this.id.indexOf(a.getClientID())==-1){this.id=a.getClientID()+"_"+this.id;if(this.tagName=="LABEL"){$(this).attr("for",this.id.replaceAll("_Error",""))}}if(this.tagName=="LABEL"){var b=$(this).attr("for");if(!a.isEmpty(b)){$(this).attr("for",a.getClientID()+"_"+b)}}});$(this.getMainContentClassName()).each(function(){if(!a.isEmpty(this.id)&&this.id.indexOf(a.getClientID())==-1){if($(this).data("client-id")===false){return}this.id=a.getClientID()+"_"+this.id}})},initCalendar:function(){var b=this;try{$(".datetime-picker",this.getMainContentClassName()).datetimepicker({format:b.calendarFormat,locale:"zh-cn",showTodayButton:true,useCurrent:false})}catch(a){}},bindMoneyInputEvent:function(a){if(this.isEmpty(a)){a=this.getMainContentClassName()}var b=this;$("[data-money='true']",a).each(function(){if(SysCmn.CoreUtility.isInputMoney(this)){b.bindEvent(this,"focus",b.moneyFocus.bind(b,this),true);b.bindEvent(this,"blur",b.moneyBlur.bind(b,this),true)}})},initValidator:function(isSearch){if($.validator==null||$.validator.methods==null){return}var thisObj=this;var rules={};var messages={};$("input[type='text'], input[type='number'], input[type='password'], textarea, select",this.getMainFormID()).each(function(){var required=$(this).hasClass("required");var minlength=$(this).data("minlength");var maxlength=$(this).data("maxlength");var rangelength=$(this).data("rangelength");var min=$(this).data("min");var max=$(this).data("max");var range=$(this).data("range");var email=$(this).data("email");var url=$(this).data("url");var date=$(this).data("date");var number=$(this).data("number");var digits=$(this).data("digits");var regex=$(this).data("regex");if(thisObj.isNull(maxlength)){maxlength=$(this).attr("maxlength")}var title=$(this).data("title");rules[this.id]={};messages[this.id]={};if(required){rules[this.id].required=true;if(this.type=="select-one"){messages[this.id].required=$M.formatMessage("请选择{0}。",title)}else{messages[this.id].required=$M.formatMessage("请输入{0}。",title)}}if(!thisObj.isEmpty(rangelength)){rules[this.id].rangelength=[rangelength[0],rangelength[1]];messages[this.id].rangelength=$M.formatMessage("请在{0}中输入[{1}-{2}]位以内的文字。",[title,rangelength[0],rangelength[1]])}if(!thisObj.isEmpty(range)){rules[this.id].range=[range[0],range[1]];messages[this.id].range=$M.formatMessage("请在{0}中输入[{1}-{2}]范围内的数值。",[title,range[0],range[1]])}if(!thisObj.isEmpty(email)){rules[this.id].email=true;messages[this.id].email=$M.formatMessage("请在{0}中输入有效的邮件地址。",title)}if(!thisObj.isEmpty(url)){rules[this.id].url=true;messages[this.id].url=$M.formatMessage("请在{0}中输入有效的URL地址。",title)}if(!thisObj.isEmpty(date)){rules[this.id].date=true;messages[this.id].date=$M.formatMessage("请在{0}中输入有效的日期。",title)}if(!thisObj.isEmpty(digits)){rules[this.id].digits=true;messages[this.id].digits=$M.formatMessage("请在{0}中输入数字。",title)}if(!thisObj.isEmpty(number)){rules[this.id].number=true;messages[this.id].number=$M.formatMessage("请在{0}中输入数值。",title)}if(!thisObj.isEmpty(min)){rules[this.id].min=min;messages[this.id].min=$M.formatMessage("请在{0}中输入大于等于{1}的数值。",[title,min])}if(!thisObj.isEmpty(max)){rules[this.id].max=max;messages[this.id].max=$M.formatMessage("请在{0}中输入小于等于{1}的数值。",[title,max])}if(!thisObj.isEmpty(minlength)){rules[this.id].minlength=minlength;messages[this.id].minlength=$M.formatMessage("请在{0}中至少输入{1}个字符。",[title,minlength])}if(!thisObj.isEmpty(maxlength)){rules[this.id].maxlength=maxlength;messages[this.id].maxlength=$M.formatMessage("请在{0}中输入最多输入{1}个字符。",[title,maxlength])}if(regex){rules[this.id].regex=regex;messages[this.id].regex=$M.formatMessage($(this).data("regex-message"),title)}});$.validator.methods.regex=function(value,element){var regex=eval($(element).data("regex"));return this.optional(element)||regex.test(value)};var submitButton=$(this.getId("btnSave"));if(this.isNotNull(isSearch)&&isSearch==true){submitButton=$(this.getId("btnSearch"))}this.validator=$(this.getMainFormID()).validate({onfocusout:false,onkeyup:false,onclick:false,showErrors:this.showValidatorErrors.bind(this),element:submitButton,rules:rules,messages:messages})},validateRequiredOption:function(){var b=this;var a=[];$(".required-option",this.getMainFormID()).each(function(){if(b.isEmpty($(this).val())){var c=$(this).data("title");if(this.type=="select-one"){a.push($M.formatMessage("<li>请选择{0}。</li>",c))}else{a.push($M.formatMessage("<li>请输入{0}。</li>",c))}}});if(a.length==0){return true}else{if(a.length>0&&this.showValidatorPopupMessage){this.showMessage("<ul>"+a.join("")+"</ul>",MSG_TYPE_VALIDATION)}return false}},showValidatorErrors:function(b){var a=[];this.clearValidatorErrors();var c=this;$.each(b,function(f,e){var d=f+"_Error";var g=c.$(f).data("title");if(e.match(/这是必填字段/)&&c.isEmpty(f)){return}if(e.match(/这是必填字段/)&&!c.isEmpty(g)){if(f=="file"){e=$M.formatMessage("请选择{0}。",g)}else{e=$M.formatMessage("请输入{0}。",g)}}a.push("<li>"+e+"</li>");if(!c.isNull(c.getDom(d))){c.$(d).html(e);c.$(d).show()}});if(a.length>0&&this.showValidatorPopupMessage){this.showMessage("<ul>"+a.join("")+"</ul>",MSG_TYPE_VALIDATION)}},clearValidatorErrors:function(){$(".validator-error").each(function(){$(this).html("");$(this).hide()})},initOptionList:function(a){var d=this.getValue("jsonOptionList");if(this.isEmpty(d)){return}var b=JsonUtility.Parse(d);var c=this;$.each(b,function(f,h){if(!c.isNull(c.getDom(f))){if($(c.getDom(f)).data("autoValue")!=false&&c.getDom(f).tagName=="SELECT"){var g=$(c.getDom(f)).data("need-blank")!=false;var e=a?"":"请选择";c.createOption(f,h,"subCd","subName",g,e)}}})},bindMaximization:function(){if(this.isNull(this.getFrame())){return}var a=this;$(".maximization",this.getFrame()).each(function(){a.bindEvent(this,"click",a.onClick_Maximization.bind(a))});$(".modal-header",this.getFrame()).each(function(){a.bindEvent(this,"dblclick",a.onClick_Maximization.bind(a))})},onClick_Maximization:function(){if(this.windowState=="normal"){this.windowState="max";var a=this.getFrame();if(this.isEmpty(this.windowProperty.width)){this.windowProperty.width=$(a).outerWidth();this.windowProperty.height=$(a).outerHeight();this.windowProperty.top=a.style.top;this.windowProperty.left=a.style.left;this.windowProperty.bodyHeight=this.parseInt($(".modal-body",this.getFrame()).css("height"))}var b="100%";if(this.windowProperty.height>$M.getClientHeight()){b=this.windowProperty.height}this.$("ctlFrame").animate({height:b,width:"100%",top:0,left:0},"fast");this.$("btnMaximization").toggleClass("fa-window-maximize fa-window-restore");if(this.isFunction(this.windowMaximizationCallback)){this.windowMaximizationCallback(true)}}else{this.windowState="normal";this.$("ctlFrame").animate({height:this.windowProperty.height,width:this.windowProperty.width,top:this.windowProperty.top,left:this.windowProperty.left},"fast");this.$("btnMaximization").toggleClass("fa-window-maximize fa-window-restore");if(this.isFunction(this.windowMaximizationCallback)){this.windowMaximizationCallback(false)}}},bindFoldEvent:function(){var a=this;$(".form-group-fold button",this.getMainContentClassName()).click(function(){var b=$(this).data("container");if(a.isEmpty(b)){return}a.$(b).toggle();$(this).find(".form-group-fold-icon").toggleClass("fa-caret-down fa-caret-up")})},initTab:function(b,c,d,a){this.tabInstance=new SysTabMultiViewClientClass(this.getId(b),c,true);if(this.isFunction(d)){this.tabInstance.OnActiveViewChanged=d.bind(this)}if(this.isNull(a)){a=0}this.tabInstance.setViewActive(a)},bindPopoversEvent:function(){try{$(".popovers").popover({html:true});$(".popovers").unbind("mouseout");$(".popovers").mouseout(function(){$(this).css("display","")})}catch(a){}},addRow:function(a){this._copyRow(a,false);if(this.isFunction(this.addRowCallback)){this.addRowCallback()}},copyRow:function(a){this._copyRow(a,true);if(this.isFunction(this.copyRowCallback)){this.copyRowCallback(a)}},_copyRow:function(d,c){var g=this;var b=$(d).parents("tr").clone(true);var e=[];var h=new Date().getTime();$("input[type='text'], input[type='number'], input[type='hidden'], button, input[type='button'], select, input[type='checkbox'], input[type='radio'], span",b).each(function(){if(!g.isEmpty(this.id)){if(this.id.indexOf("uid")==0){$(this).val("")}var j=this.id;var i=this.id.split("|");if(i.length==2){this.id=i[0]+"|"+h}else{this.id=i[0]+"|"+h+"|"+i[2]}var k=this.tagName.toUpperCase();if(k=="SELECT"||k=="INPUT"){if(this.id.indexOf("uid")!=0){var l={};l.id=this.id;l.value=$($E(j)).val();e.push(l)}}}});$(".select2-container",b).each(function(){$(this).remove()});$(".select2-hidden-accessible",b).each(function(){$(this).removeClass("select2-hidden-accessible")});var a=$("<tr></tr>");a.html(b.get(0).innerHTML);a.insertAfter($(d).parents("tr"));var f=$(d).parents("table");this.resetRowNo(f);$.each(e,function(i,k){var j=g.$(k.id);if(c){j.val(k.value)}else{if(j.data("allow-clear")!=false){j.val("")}}if(j.attr("aria-hidden")){j.select2()}});this.initSelect2Required()},deleteRow:function(a){var c=$(a).parents("table");if($("tr",c).length==2){this.showMessage("最后一行数据禁止删除。",MSG_TYPE_ERROR);return}var b=$(a).parents("tr");$(b).remove();this.resetRowNo(c);if(this.isFunction(this.deleteRowCallback)){this.deleteRowCallback()}},resetRowNo:function(b){var a=0;$("tr",b).each(function(){$(".row-no",this).html(a);a++})},isNull:function(a){return $M.isNull(a)},isNotNull:function(a){return !$M.isNull(a)},isEmpty:function(a){return $M.isEmpty(a)},isNotEmpty:function(a){return !$M.isEmpty(a)},formatNum:function(b,a,c){return $M.formatNum(b,a,c)},formatCny:function(b,a){if(this.isEmpty(a)){a=this.amountPrecision}return $M.formatCny(b,a)},formatJpy:function(b,a){return $M.formatJpy(b,a)},formatDollar:function(b,a){return $M.formatDollar(b,a)},validIDCard:function(a){return $M.validIDCard(a)},parseFloat:function(a){a=parseFloat(a);return isNaN(a)?0:a},parseInt:function(a){a=parseInt(a,10);return isNaN(a)?0:a},$:function(a){return $(this.getDom(a))},switchOn:function(a){this.$(a).bootstrapSwitch("state",true)},switchOff:function(a){this.$(a).bootstrapSwitch("state",false)},displayDomByClass:function(a,b){if(b==true){$(a).show()}else{$(a).hide()}},displayDom:function(b,a){if(a==true){this.$(b).show()}else{this.$(b).hide()}},isChecked:function(a){if(this.isNull(this.getDom(a))){return false}return this.getDom(a).checked},isDisplayed:function(a){if(typeof a=="string"){a=this.getDom(a)}if($(a).css("display")==="none"){return false}return true},isWeixinBrowser:function(){return $M.isWeixinBrowser()},setMessageBoxWidth:function(a){SysCmn.CmnMsg.setWidth(a)},setMessageBoxTitle:function(a){SysCmn.CmnMsg.setTitle(a)},showMessage:function(b,c,a){SysCmn.CmnMsg.showMessage(b,c,a)},hideMessage:function(){SysCmn.CmnMsg.hide()},showErrorMessage:function(b,a){SysCmn.CmnMsg.showMessage(b,MSG_TYPE_ERROR,a)},showWarningMessage:function(b,a){SysCmn.CmnMsg.showMessage(b,MSG_TYPE_WARNING,a)},showInfoMessage:function(b,a){SysCmn.CmnMsg.showMessage(b,MSG_TYPE_INFO,a)},showValidationMessage:function(b,a){SysCmn.CmnMsg.showMessage(b,MSG_TYPE_VALIDATION,a)},showProcessing:function(a){SysCmn.CmnMsg.showProcessing(a)},showConfirm:function(b,d,c,a){SysCmn.CmnMsg.showConfirm(b,d,c,a)},convertNum:function(a){return $M.convertNum(a)},toFixed:function(b,a){return $M.toFixed(b,a)},encodeValue:function(a){return $M.encodeValue(a)},brToEnter:function(a){return $M.brToEnter(a)},enterToBr:function(a){return $M.enterToBr(a)},isEntryFromMenu:function(){return(this.entry=="menu")},convertAmount:function(a){a.value=this.convertNum(a.value)},convertNumber:function(a){this.convertAmount(a)},convertAmountToNumber:function(a){a.value=this.convertNum(a.value)},convertNumberToAmount:function(a){if(Object.isUndefined(a)){return}if(!this.isDouble(a)){a.value="0"}else{if(parseFloat(a.value)<0){a.value="0"}}a.value=this.formatCny(a.value)},moneyFocus:function(a){a.value=this.convertNum(a.value);if(this.isFunction(this.moneyFocusCallback)){this.moneyFocusCallback(a)}},trimSpecialChar:function(a){if(this.isEmpty(a)){return a}return a.replaceAll("'","").replaceAll('"',"")},showPageLoader:function(){$("#page-preloader").fadeIn()},moneyBlur:function(a){a.value=this.convertNum(a.value);if(!this.isDouble(a)){this.setValue(a,"0")}a.value=this.formatCny(a.value);if(this.isFunction(this.moneyBlurCallback)){this.moneyBlurCallback(a)}},isMobile:function(a){if(this.isEmpty(a)){return false}if(a.match(/^1(3|4|5|6|7|8|9)\d{9}$/)==null){return false}else{return true}},isNumber:function(a){if(this.isEmpty(a)){return false}if(a.match(/^\d+$/)==null){return false}else{return true}},isRange:function(c,b,a){if(!this.isNumber(c)){return false}if(c-b<0||c-a>0){return false}return true},isEnglishString:function(a){if(this.isEmpty(a)){return false}if(a.match(/^[a-zA-Z ]+$/)==null){return false}else{return true}},isEnglishOrNumber:function(a){if(this.isEmpty(a)){return false}if(a.match(/^[a-zA-Z0-9 ]+$/)==null){return false}else{return true}},isEqualLength:function(b,a){if(this.isEmpty(b)){return false}if(b.length!=a){return false}return true},isLessLength:function(b,a){if(this.isEmpty(b)){return false}if(b.length>a){return false}return true},isMoreLength:function(b,a){if(this.isEmpty(b)){return false}if(b.length<a){return false}return true},isValidUserCd:function(b,a){if(this.isEmpty(b)){return false}if(b.match(/^[a-zA-Z0-9_@\.-]+$/)==null||b.length>a){return false}else{return true}},isASCIIWithoutControlChar:function(a){if(this.isEmpty(a)){return false}if(a.match(/^[!-~]*$/g)!=null){return true}return false},isValidPassword:function(a,d,c,b){if(this.isMoreLength(a,c)==false){return false}if(this.isLessLength(a,b)==false){return false}if(!this.isASCIIWithoutControlChar(a)){return false}if(d=="1"){if(a.match(/[0-9]/)!=null&&a.match(/[A-Za-z]/)!=null){return true}else{return false}}else{if(d=="2"){if(!this.isNumber(a)){return false}}}return true},isDate:function(e){if(this.isEmpty(e)){return false}var a=new Date(e);var f=a.getFullYear();var c=a.getMonth()+1;if(c<10){c="0"+c}var b=a.getDate();if(b<10){b="0"+b}var d=f+"/"+c+"/"+b;if(e==d){return true}else{return false}},getFirstDayOfMonth:function(a){a.setDate(1);return a.formatYMD()},getFirstDayOfCurrentMonth:function(){return this.getFirstDayOfMonth(new Date())},getLastDayOfMonth:function(a){return new Date(a.getFullYear(),a.getMonth()+1,0).formatYMD()},getLastDayOfCurrentMonth:function(){return this.getLastDayOfMonth(new Date())},getEChartsTitle:function(b,a){if(this.isEmpty(a)){a=14}return{text:b,x:"center",textStyle:{fontSize:a},subtextStyle:{color:"#3398db"}}},getEChartsBarToolbox:function(b,a){if(this.isNull(b)){b=true}if(this.isNull(a)){a=true}return{show:b,feature:{dataView:{show:true,readOnly:false},magicType:{show:a,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}}},getEChartsBarTooltip:function(){return{trigger:"axis",axisPointer:{type:"shadow"}}},getEChartsXAxis:function(a){var b={type:"category",data:[]};if(this.isNotNull(a)){b.axisLabel=this.getEChartsAxisLabel(a)}return b},getEChartsYAxis:function(a,b){if(this.isNull(b)){b=3}var c={type:"value",name:a,splitNumber:b};return c},getEChartsGridOption:function(a){var b={left:"4.5%",right:"4.5%"};if(this.isNotNull(a)){b.bottom=a}return[b]},getEChartsSeriesOption:function(c,g,a,e,f){if(this.isNull(g)){g="bar"}if(this.isNull(a)){a=10}if(this.isNull(e)){e=true}if(this.isNull(f)){f=true}var b={};if(e){b={data:[{type:"average",name:"平均值"}]}}var d={name:c,barWidth:a,barGap:"50%",type:g,data:[],label:{normal:{show:f,position:"top",textStyle:{fontSize:"8"}}},markLine:b};return d},getEChartsAxisLabel:function(a){return{interval:0,rotate:a,margin:8,textStyle:{color:"#222"}}},sumEChartsSeriesValue:function(b){var c=0;for(var a=0;a<b.length;a++){if(this.isNull(b[a])){continue}if(this.isNull(b[a].value)){c+=b[a]}else{c+=b[a].value}}return c},titlePromptBox:function(){var a=$(".title-prompt-box");a.unbind("mouseenter");a.unbind("mouseleave");a.mouseenter(function(){var f=$(".title-prompt-float");if(f.length>0){$(".prompt-float").html($(this).data("title"))}else{$("body").append("<div class='title-prompt-float'><i class='fa'></i><div class='prompt-float'>"+$(this).data("title")+"</div></div>")}var f=$(".title-prompt-float");var b=$(this).data("placement");var g=$(this).offset().top;var e=$(this).offset().left;var i=$(this).width();var d=$(this).height();var h=f.children("div").width();var c=f.children("div").height();f.children("i").removeClass("fa-caret-right").removeClass("fa-caret-left").removeClass("fa-caret-up").removeClass("fa-caret-down");if(b=="right"){f.addClass("title-prompt-right");f.children("i").addClass("fa-caret-left");f.css({top:g-10,left:e+i+25});f.children("i").css("top",c/2-1)}if(b=="left"||b==undefined){f.addClass("title-prompt-left");f.children("i").addClass("fa-caret-right");f.css({top:g-10,left:e-h-42});f.children("i").css("top",c/2-1)}if(b=="top"){f.addClass("title-prompt-top");f.children("i").addClass("fa-caret-down");f.css({top:g-c-35,left:e+i/2-h/2-17});f.children("i").css("left",h/2+10)}if(b=="bottom"){f.addClass("title-prompt-bottom");f.children("i").addClass("fa-caret-up");f.css({top:g+d+20,left:e-h/2});f.children("i").css("left",h/2+15)}});a.mouseleave(function(){$(".title-prompt-float").remove()})},initIScroll:function(){$(".iscroll-wrapper").each(function(){var a=$(this).data("iscroll-id");if($M.isEmpty(a)){return}window[a]=new IScroll(this,IScrollUtility.getGlobalOptions())})},hangUp:function(a){this.displayDom("hangUp_"+a,false);this.displayDom("call_"+a,true);this.callPhoneUid="";this.dropMode()},localCall:function(b,a){if(this.isEmpty(this.callPhoneUid)){this.displayDom("call_"+b,false);this.displayDom("hangUp_"+b,true);this.callPhoneUid=b;this.dialMode(a,1)}else{this.showErrorMessage("当前正在通话中，请先挂断电话，再拨打！")}},otherPlacesCall:function(b,a){if(this.isEmpty(this.callPhoneUid)){this.displayDom("call_"+b,false);this.displayDom("hangUp_"+b,true);this.callPhoneUid=b;this.dialMode(a,2)}else{this.showErrorMessage("当前正在通话中，请先挂断电话，再拨打！")}},dialMode:function(a,c){var b=this;if(c==1){a="9"+a.trim()}else{a="90"+a.trim()}window.frames.ctiCommon.station.dial(a).then(function(d){console.info("外拨"+d)})["catch"](function(d){b.showErrorMessage(d.message)})},dropMode:function(){var a=this;window.frames.ctiCommon.station.drop().then(function(b){console.info("挂断")})["catch"](function(b){a.showErrorMessage(b.message)})},hangUpPhone:function(){this.displayDom("hangUp_"+this.callPhoneUid,false);this.displayDom("call_"+this.callPhoneUid,true);this.callPhoneUid=""}};SysCmn.CoreInput=Class.create();SysCmn.CoreInput.prototype=Object.extend(new SysCmn.Core(),{initialize:function(){this.initCommonProperty();this.callback=function(){};this.editMode=0;this.saveType=1;this.initFormDomValue=true;this.saveMethod="save";this.isInputPage=true},isAddMode:function(){return(this.editMode==0)},isEditMode:function(){return(this.editMode==1)},isDetailMode:function(){return this.isDetail},init:function(){SysCmn.ClientIDList.push(this.clientID);this.initDomId();this.initDomName();this.saveConfirmMessage="确定要保存吗？";if(this.isEmpty(window.ShowSaveDataConfirmMessage)){this.showSaveDataConfirmMessage=true}else{this.showSaveDataConfirmMessage=window.ShowSaveDataConfirmMessage}var a=["ctlFrame","ctlTitle","btnImport","btnSave","btnSaveSubmit","btnDelete","btnClear","btnAudit","btnAuditReturn","btnAuditCancel","btnBack","jsonInputEntity","jsonTableColumns","btnClose","btnTopClose","btnHelp"];this.initCommonDomIds(a);if(this.isNotNull(this.dom.jsonTableColumns)){this.tableColumns=JsonUtility.Parse($E(this.dom.jsonTableColumns).value)}this.initCore();this.initOptionList(false);if(this.isPopupMode()&&this.isNotNull(this.dom.ctlTitle)){this.hide();$(this.getFrame()).css("position","absolute");var b=this;$(".modal-header",this.getFrame()).each(function(){b.bindEvent(this,"mousedown",function(c){SysCmn.DragDrop.Start(b.getFrame().id,c)}.bind(b))})}this.bindEvent(this.dom.btnImport,"click",this.onClick_Import.bind(this));this.bindEvent(this.dom.btnSave,"click",this.onClick_Save.bind(this,1));this.bindEvent(this.dom.btnSaveSubmit,"click",this.onClick_Save.bind(this,2));this.bindEvent(this.dom.btnBack,"click",this.onClick_Back.bind(this));this.bindEvent(this.dom.btnDelete,"click",this.onClick_Delete.bind(this));this.bindEvent(this.dom.btnAudit,"click",this.onClick_Audit.bind(this,1));this.bindEvent(this.dom.btnAuditReturn,"click",this.onClick_Audit.bind(this,2));this.bindEvent(this.dom.btnAuditCancel,"click",this.onClick_Audit.bind(this,3));this.bindEvent(this.dom.btnClear,"click",this.onClick_Clear.bind(this));this.bindEvent(this.dom.btnClose,"click",this.onClick_Close.bind(this));this.bindEvent(this.dom.btnTopClose,"click",this.onClick_Close.bind(this));this.bindEvent(this.dom.btnHelp,"click",this.showHelp.bind(this));if(this.isFunction(this.initCallback)){this.initCallback()}this.bindPopoversEvent();this.initInputValue();this.initDetailForm();if(this.autoHideFlashMessage){this.hideFlashMessage()}this.initValidateDuplication();this.initDomPlaceHolder();if(this.isFunction(this.initValidator)){this.initValidator()}if(this.initCalendarFlag){this.initCalendar()}this.bindMoneyInputEvent();this.bindFoldEvent();this.bindMaximization()},initDetailForm:function(){if(this.isDetailMode()){this.disableInput(this.getMainFormID(),true);if(this.isNotNull($E(this.dom.btnSave))){this.displayDom(this.dom.btnSave,false);this.displayDom(this.dom.btnSaveSubmit,false)}}else{this.disableInput(this.getMainFormID(),false);this.displayDom(this.dom.btnSave,true)}if(this.isPopupMode()&&this.isAddMode()){if(this.isNotEmpty(this.getClientID())){this.setValue(this.getClientID()+"_"+this.getPrimaryKey(),"")}else{this.setValue(this.getPrimaryKey(),"")}}if(this.isFunction(this.initInputFormAfter)){this.initInputFormAfter()}this.initSelect2Required()},onClick_Import:function(){if(!Page_ClientValidate()){return false}this.showConfirm("确定要进行数据的导入处理吗？",this.importData.bind(this));return false},importData:function(){if(this.showProcessingMessage){this.showProcessing(false)}this.getDom("btnImportSubmit").disabled=false;this.getDom("btnImportSubmit").click()},onClick_Save:function(a){this.saveType=a;if(this.isFunction(this.customSave)){this.customSave();return}if(this.isFunction(this.customSaveConfirmMessage)){this.saveConfirmMessage=this.customSaveConfirmMessage(a)}if(this.checkData()){if(this.showSaveDataConfirmMessage){this.showConfirm(this.saveConfirmMessage,this.saveData.bind(this,a))}else{this.saveData()}}},onClick_Back:function(){this.showPageLoader();window.location=this.listUrl},onClick_Delete:function(){this.showConfirm(this.deleteConfirmMessage,this.deleteData.bind(this))},onClick_Audit:function(a){if(!this.checkData()){return}if(a==1){this.showConfirm("审核通过后不能再修改审核意见，确定要审核通过吗？",this.auditData.bind(this,1))}else{if(a==2){this.showConfirm("确定要审核退回吗？",this.auditData.bind(this,2))}else{if(a==3){this.showConfirm("确定要反审核吗？",this.auditData.bind(this,3))}}}},getEntityByCssClass:function(a,c){if(this.isEmpty(c)||typeof c==="string"){c={}}if(this.isNull(this.getClientID())){this.showMessage("Js Class ClientID is not defined.",MSG_TYPE_WARNING)}var d=this;var b=this.getClientID();$("input[type='text'], input[type='number'], input[type='hidden'], input[type='password'], input[type='radio'], input[type='checkbox'], select, textarea",a).each(function(){var e=SysCmn.CoreUtility.getFieldName(b,this.id);var f="";if(e.indexOf(".")>0){f=e.split(".")[0];e=e.split(".")[1];if(d.isEmpty(c[f])){c[f]={}}}if(this.type=="checkbox"||this.type=="radio"){var i=this.value;if($M.isEmpty(i)||i=="on"){i=1}if(d.isNotEmpty(f)){c[f][e]=this.checked?i:0}else{c[e]=this.checked?i:0}}else{if(SysCmn.CoreUtility.isInputMoney(this)){if(d.isNotEmpty(f)){c[f][e]=d.convertNum($M.trim(this.value))}else{c[e]=d.convertNum($M.trim(this.value))}}else{var i=$(this).val();if(i instanceof Array){i=i.join(",")}if(d.isNotEmpty(f)){c[f][e]=$M.trim(i)}else{c[e]=$M.trim(i)}if(this.type=="select-one"||this.type=="select-multiple"){var h="";$(this).find("option:selected").each(function(){if($M.isEmpty(h)){h=$(this).text()}else{h+=","+$(this).text()}});var g="";if(e.endsWith("Uid")){g=e.substring(0,e.length-3)+"Name"}if(e.endsWith("Cd")){g=e.substring(0,e.length-2)+"Name"}if(h.startsWith("请选择")){h=""}if(d.isNotEmpty(g)){if(d.isNotEmpty(f)){c[f][g]=$M.trim(h)}else{c[g]=$M.trim(h)}}}}}});return c},getInputEntity:function(a){if(this.isNull(a)){a={}}return this.getEntityByCssClass(this.getMainFormID(),a)},saveData:function(b){this.inputEntity=this.getInputEntity(this.inputEntity);if(this.getPrimaryKey()=="uid"&&this.isEmpty(this.inputEntity.recordStatus)){this.inputEntity.recordStatus=1}else{if(this.getPrimaryKey()!="uid"&&this.isEmpty(this.inputEntity.deleted)){this.inputEntity.deleted=1}}if(this.isFunction(this.customInputEntity)){this.customInputEntity()}var a="inputJson="+JsonUtility.ToJSON(this.inputEntity)+"&editMode="+this.editMode;if(!$M.isEmpty(b)){a=a+"&saveType="+b}if(this.isFunction(this.customRequestParams)){a+="&"+this.customRequestParams()}if(this.showProcessingMessage){this.showProcessing(false)}AjaxIns.sendPOST(this.controller+this.saveMethod,this.saveDataCallback.bind(this),a)},saveDataCallback:function(b){if($M.isAjaxFail(b.responseText)){return}var a=JsonUtility.Parse(b.responseText);if(this.isFunction(this.customSaveDataCallback)){this.customSaveDataCallback(a)}if(a.result>0){if(this.showSaveDataSuccessMessage){if(this.isSaveSuccessAfterRefreshList){this.showMessage(a.message,MSG_TYPE_INFO,this.refreshList.bind(this))}else{this.showMessage(a.message,MSG_TYPE_INFO)}}else{if(this.isSaveSuccessAfterRefreshList){this.refreshList()}else{this.hideMessage()}}}else{this.showMessage(a.message,MSG_TYPE_ERROR)}},show:function(a,b,c){if(this.isDetailMode()){this.displayDom(this.dom.btnDelete,!this.isDetailMode());this.displayDom(this.dom.btnSave,!this.isDetailMode());this.displayDom(this.dom.btnClear,!this.isDetailMode())}else{}if(this.isNotEmpty(c)){this.getDetail(c,b,a)}else{return this._show(a,b)}},getDetail:function(c,b,a){if(this.isEmpty(b)){b=1}var d="uid="+c;if(this.showProcessingMessage){this.showProcessing()}AjaxIns.sendPOST(this.controller+"getDetail",this.getDetailCallback.bind(this,a,b),d)},getDetailCallback:function(a,b,c){if($M.isAjaxFail(c.responseText)){return}this.hideMessage();this.inputEntity=JsonUtility.Parse(c.responseText);this.initInputForm(this.inputEntity);this._show(a,b)},_show:function(a,b){this.clearValidatorErrors();if(this.isPopupMode()){if(this.popupSwitchPage==true&&this.isNotNull(this.parentFrame)){this.switchPage(true)}else{SysCmn.CtrlUtil.SetPopupPosition(this.getFrame(),this.popupPosition);SysCmn.EstopLayer.show(this.getFrame());$(this.getFrame()).fadeIn()}}if(this.isNotNull(a)){this.callback=a}this.initInputValue(b);this.initDetailForm();if(this.isPopupMode()&&this.isFunction(this.showCallback)){this.showCallback()}},initInputValue:function(a){if(this.isNotNull(a)){this.editMode=a}if(this.isNotNull($E(this.dom.jsonInputEntity))&&(!this.isPopupMode()||this.isPageMode)){this.inputEntity=JsonUtility.Parse($E(this.dom.jsonInputEntity).value);var b=this.getPkValue(this.inputEntity,this.getPrimaryKey());if(this.isNotEmpty(b)&&(this.inputEntity.recordStatus==1||this.inputEntity.recordStatus==8||this.inputEntity.deleted==1)){if(this.inputEntity.addMode){this.editMode=0}else{this.editMode=1}}}if(this.isFunction(this.initInputFormBefore)){this.initInputFormBefore()}if(this.isNotNull(this.inputEntity)&&this.initFormDomValue){this.initInputForm(this.inputEntity)}if(!this.isDetailMode()){this.displayDom(this.dom.btnDelete,this.isEditMode())}},refreshList:function(){if($M.isEmpty(this.listUrl)){SysCmn.CmnMsg.hide(true);this.hide();if(this.isFunction(this.callback)){this.callback(true,this.inputEntity)}}else{this.showPageLoader();window.location=this.listUrl}},checkImportFileType:function(b){var a=$M.getExtension(this.getValue(b));if(a!="xls"&&a!="xlsx"){return false}else{return true}},initValidateDataType:function(){var a=this;$("input[type='text']",this.getMainContentClassName()).each(function(){if($(this).data("type")=="double"){a.bindEvent(this,"blur",a.allowDouble.bind(a,this))}else{if($(this).data("type")=="integer"){a.bindEvent(this,"blur",a.allowInteger.bind(a,this))}}})},setTitle:function(b){var a=$("title");var c=a.html().split("-");a.html(c[0]+"-"+b)}});SysCmn.CoreImport=Class.create();SysCmn.CoreImport.prototype=Object.extend(new SysCmn.CoreInput(),{getPrimaryKey:function(){return"uid"},showCallback:function(){},initCommonCallback:function(){},closePopupAfter:function(){this.clearForm();this.$("divSummary").html("");this.$("divList").html("")},validateFormAfter:function(){var a=this.getValue("file");if(this.isEmpty(a)){this.showErrorMessage("请选择需要导入的文件。")}else{if(!a.endsWith(".xls")&&!a.endsWith(".xlsx")){this.showErrorMessage("请选择后缀名为.xls或者.xlsx的Excel文件上传。")}else{if(this.isEmpty(this.importConfirmMessage)){this.importConfirmMessage="确定要导入文件吗？"}this.showConfirm(this.importConfirmMessage,this.uploadFile.bind(this))}}return false},uploadFile:function(){this.showProcessing(false);setTimeout(this._uploadFile.bind(this),200)},_uploadFile:function(){var b=this;var a=new FormData(this.getDom("MainForm"));$.ajax({url:this.saveMethod,type:"POST",data:a,async:false,cache:false,contentType:false,processData:false,success:function(e){if($M.isAjaxFail(e)){return}var c=JsonUtility.Parse(e);if(c.result>0){b.showInfoMessage("数据导入完成，详细结果请参照数据导入结果列表。");var d=c.content;b.setImportResultSummaryInfo(d);b.createImportResultTable(d.batchImportDetailList,b.showSuccessResult)}else{b.showErrorMessage(c.message)}},error:function(c){b.showErrorMessage(c)}})},setImportResultSummaryInfo:function(a){var b="更新成功：<strong class='warning-blue-cell'>"+a.successCount+"</strong>条记录";b+="，更新失败：<strong class='warning-red-cell'>"+a.errorCount+"</strong>条记录";if(a.spendTime>0){b+="，花费时间：<strong class='warning-blue-cell'>"+a.spendTime+"</strong>秒"}if(a.totalSummary>0){b+="，总计：<strong class='warning-blue-cell'>"+a.totalSummary+"</strong>"}this.$("divSummary").html(b)},createImportResultTable:function(c,d){if(this.isEmpty(d)){d=true}this.colList=new Array();this.initTableColList();this.datagrid=new SysCmn.DataGrid();if(!d){var b=[];for(var a=0;a<c.length;a++){if(c[a].importResultFlag!=0){b.push(c[a])}}c=b}this.datagrid.init(this.getId("divList"),c,this.colList,this.cellCallback.bind(this));this.datagrid.ellipsisAllCol=true;this.datagrid.useRowClickEvent=false;this.datagrid.useCheckOne=false;this.datagrid.useRowNo=true;this.datagrid.cellClassCallback=this.cellClassCallback.bind(this);this.datagrid.cssClass="app-table-list app-table-list-input";this.datagrid.resizeLastColumnWidth=false;this.datagrid.create()},cellClassCallback:function(c,b,a){if(b=="importResult"){if(c.importResultFlag==0){return"warning-green-background-cell"}else{return"warning-red-background-cell"}}},cellCallback:function(b,a,c){var d=b[a];return d}});SysCmn.CoreList=Class.create();SysCmn.CoreList.prototype=Object.extend(new SysCmn.Core(),{initialize:function(){this.initCommonProperty();this.colList=[];this.autoSearch=true;this.defaultPageSize=10;this.useSearchCondition=true;this.useSearchValidate=true;this.reInitTableColList=false;this.data={};this.searchMethod="search";this.importMethod="import";this.autoSaveSearchCondition=true;this.includeGroupQuery=false;this.includeOrderQuery=false;this.useEnterSearch=true;this.datagridForceHorizontalScroll=false;this.isSearchButtonClick=true;this.onlySearchButtonClickCountRecord=false;this.isListPage=true},init:function(){SysCmn.ClientIDList.push(this.clientID);this.initDomId();this.initDomName();var a=["ctlFrame","ctlTitle","btnSearch","btnExport","btnClear","btnImport","btnAdd","btnDelete","btnAudit","divList","btnSelectOk","btnClose","btnTopClose","jsonListData","btnColumnSetting","btnSearchSetting","btnHelp"];this.initCommonDomIds(a);this.initCore();this.initOptionList(true);this.bindEvent(this.dom.btnSearch,"click",this.onClick_Search.bind(this));this.bindEvent(this.dom.btnExport,"click",this.onClick_Export.bind(this));this.bindEvent(this.dom.btnClear,"click",this.onClick_Clear.bind(this));this.bindEvent(this.dom.btnAdd,"click",this.onClick_Add.bind(this));this.bindEvent(this.dom.btnImport,"click",this.onClick_Import.bind(this));this.bindEvent(this.dom.btnDelete,"click",this.onClick_Delete.bind(this));this.bindEvent(this.dom.btnAudit,"click",this.onClick_Audit.bind(this));this.bindEvent(this.dom.btnSelectOk,"click",this.onClick_SelectOk.bind(this));this.bindEvent(this.dom.btnClose,"click",this.onClick_Close.bind(this));this.bindEvent(this.dom.btnTopClose,"click",this.onClick_Close.bind(this));this.bindEvent(this.dom.btnColumnSetting,"click",this.showColumnSetting.bind(this));this.bindEvent(this.dom.btnSearchSetting,"click",this.showSearchSetting.bind(this));this.bindEvent(this.dom.btnHelp,"click",this.showHelp.bind(this));if(this.isPopupMode()&&this.isNotNull(this.dom.ctlTitle)){$(this.getFrame()).css("position","absolute");var b=this;$(".modal-header",this.getFrame()).each(function(){b.bindEvent(this,"mousedown",function(c){SysCmn.DragDrop.Start(b.getFrame().id,c)}.bind(b))})}this.datagrid=new SysCmn.DataGrid();if(this.isFunction(this.getPageSize)){this.datagrid.setPageSize(this.getPageSize())}else{this.datagrid.setPageSize(this.defaultPageSize)}this.datagrid.useCheckOne=true;this.datagrid.useCheckAll=true;this.initDataGrid();this.restoreSearchCondition();if(this.isFunction(this.initCallback)){this.initCallback()}this.bindPopoversEvent();if(this.autoSearch){this.getList(true)}else{if(this.existJsonListData()){this.restoreDefaultList()}}if(this.autoHideFlashMessage){this.hideFlashMessage()}this.initValidateDuplication();this.initDomPlaceHolder();if(this.isFunction(this.initValidator)){this.initValidator(true)}if(this.initCalendarFlag){this.initCalendar()}if(this.useEnterSearch){this.initEnterSearch()}this.bindMoneyInputEvent();this.initSearchSetting();this.bindFoldEvent();this.bindMaximization()},setPageSize:function(a){this.pageSize=a;this.datagrid.setPageSize(this.pageSize)},initDataGrid:function(){if(this.isFunction(this.initAllColList)){try{this.initAllColList()}catch(a){this.showErrorMessage("initAllColList调用失败："+a)}}if(this.isFunction(this.initTableColList)){try{this.initTableColList()}catch(a){this.showErrorMessage("initTableColList调用失败："+a)}}try{this.initColumnSetting()}catch(a){this.showErrorMessage("initColumnSetting调用失败："+a)}},initColumnSetting:function(){if(this.isNull(this.allColList)||this.isNull(this.datagrid)){return}this.myColumnSetting=[];if(this.isNull(this.getDom("jsonColumnSetting"))){return}var a=this.getValue("jsonColumnSetting");if(this.isEmpty(a)){return}this.myColumnSetting=JsonUtility.Parse(a);if(this.isNull(this.myColumnSetting)){return}var c=this;if(this.myColumnSetting.length>0){this.datagrid.resizeLastColumnWidth=true;var b=[];$.each(this.myColumnSetting,function(){var d=this;$.each(c.allColList,function(){if(this.colName==d){b.push(this)}})});this.colList=b;this.datagrid.resizeLastColumnWidth=false}},isSearchCondition:function(b){if(this.isNull(b)){return false}var c=1;b=$(b);while(c<=5){b=b.parent();if(this.isNull(b)){return false}var a=b.attr("class");if(this.isNotNull(a)&&a.indexOf("form-group")>-1){return b}c++}return false},getJsonSearchSetting:function(){if(this.isNull(this.jsonSearchSetting)){this.jsonSearchSetting=JsonUtility.Parse(this.getValue("jsonSearchSetting"))}return this.jsonSearchSetting},initSearchSetting:function(){if(this.isEmpty(this.getValue("jsonSearchSetting",true))){return}console.log("initSearchSetting...初期化自定义检索设定开始");var b=this.getDom("MainForm");var d=1;if(this.isNotNull(SysApp.Cmn.SearchSettingIns)){d=SysApp.Cmn.SearchSettingIns.searchIndex}var a=this.getJsonSearchSetting();if(this.isNull(a)){return}var e=a[d-1]||{};var c=JsonUtility.Parse(e.parameters||[]);if(c.length==0){return}var f=this;$.each(b.select("input[type='text'], select"),function(h,i){var g=f.isSearchCondition(i);if(g){g.css("display","none");var j=false;$.each(c,function(l,k){if(k=="search_"+$(i).attr("id")){j=true;g.css("display","block")}});if(j==false){$(i).val("")}}});$.each(b.select(".popovers > button"),function(i,g){var h=f.getDom($(g).data("container"));if(h.select("div.form-group[style='display: block;']").length==0){$(g).parent().parent().css("display","none");$(h).css("display","none")}else{$(g).parent().parent().css("display","block");if($(h).data("force-fold")!=true){$(h).css("display","block")}}});console.log("initSearchSetting...初期化自定义检索设定结束")},showSearchSetting:function(){SysApp.Cmn.SearchSettingIns.show()},showColumnSetting:function(){SysApp.Cmn.ColumnSettingIns.show()},restoreSearchCondition:function(){var b=$E(this.getClientID()+"_jsonSearchCondition");if(this.isNull(b)){return}if(this.isEmpty(b.value)){return}var a=JsonUtility.Parse(b.value);var c=this;$.each(a,function(g,i){var d="";if(g.indexOf(".")!=-1){d=g.substr(0,g.indexOf("."));g=g.substr(g.indexOf(".")+1)}var h="";if(g.indexOf("$")!=-1){var f=g.split("$");g=f[0];h=f[1]}var e=[];e.push(g);if(!c.isEmpty(d)){e.push(d+"."+g)}if(!c.isEmpty(h)){e.push(g+"$"+h);e.push(d+"."+g+"$"+h)}$.each(e,function(l,k){var m=c.getDom(k);if(!$M.isNull(m)){var j=$(m).data("allow-restore");if(j==false){return}else{if(j==true){c.restoreValue(m,i);return}}if(m.type=="hidden"){return}if(m.disabled){return}c.restoreValue(m,i)}})})},restoreValue:function(a,b){if(a.type=="checkbox"||a.type=="radio"){if(this.isNotEmpty(b)&&b!=0){a.checked=true}else{a.checked=false}}else{if(a.type=="select-multiple"){if(this.isNotEmpty(b)){if(b.indexOf(",")==0){b=b.substring(1)}var c=b.split(",");$(a).val(c)}}else{$(a).val(b)}}},show:function(a){this.callback=a;if(this.isPopupMode()){if(this.popupSwitchPage==true&&this.isNotNull(this.parentFrame)){this.switchPage(true)}else{SysCmn.CtrlUtil.SetPopupPosition(this.getFrame(),this.popupPosition);SysCmn.EstopLayer.show(this.getFrame());$(this.getFrame()).fadeIn()}}if(this.isNotNull($E(this.dom.btnClose))){$E(this.dom.btnClose).focus()}if(this.isFunction(this.showCallback)){this.showCallback()}},refreshDataGrid:function(){try{this.datagrid.clearCheck();this.datagrid.create()}catch(a){}},onClick_Search:function(){if(this.useSearchValidate&&this.validateForm()==false){return false}if(this.isFunction(this.customSearch)){if(this.isFunction(this.customDomValue)){this.customDomValue()}this.customSearch()}else{this.getList(true)}},onClick_Export:function(){if(!this.hasListData()){this.showErrorMessage("没有相关数据，请重新调整检索条件后再导出数据。");return}var a=0;if(this.isNotNull(this.datagrid.pager)&&this.isNotNull(this.datagrid.pager.data)&&this.datagrid.pager.data.totalElements>0){a=this.datagrid.pager.data.totalElements}else{a=this.datagrid.data.length}this.showConfirm("将导出<b>&nbsp;"+a+"&nbsp;</b>条数据，导出数据需要等待一定的处理时间，<br/>确定要导出数据吗？",this.exportData.bind(this))},hasListData:function(){if(this.isNotNull(this.datagrid)&&this.isNotNull(this.datagrid.data)&&this.datagrid.data.length>0){return true}return false},exportData:function(){this.hideMessage();if(this.useSearchValidate&&this.validateForm()==false){return false}if(this.isFunction(this.customDomValue)){this.customDomValue()}if(this.isFunction(this.initTableColList)){this.colList=[];this.initTableColList()}if(this.isFunction(this.initAllColList)){this.allColList=[];this.initAllColList()}this.output()},onClick_Add:function(){if(this.validateInputObject()==false){return}if(this.isFunction(this.validateAddBefore)){if(this.validateAddBefore()==false){return}}if(this.isFunction(this.customAdd)){this.customAdd();return}if(this.isEmpty(this.inputUrl)){this.goInput()}else{this.showPageLoader();window.location=this.inputUrl}},onClick_Import:function(){if(this.isEmpty(this.importUrl)){this.showConfirm("确定要同步数据吗？",this.importData.bind(this))}else{this.showPageLoader();window.location=this.importUrl}},importData:function(){if(this.showProcessingMessage){this.showProcessing(false)}AjaxIns.sendPOST(this.controller,this.importDataCallback.bind(this),null,this.importMethod)},importDataCallback:function(b){if($M.isAjaxFail(b.responseText)){return}var a=JsonUtility.Parse(b.responseText);this.showMessage(a.message,MSG_TYPE_INFO,this.refreshList.bind(this))},onClick_Delete:function(a,d){if(a>=0){var b=null;if(this.isNull(d)){b=this.datagrid.data[a]}else{b=SysCmn.DataGridList[d].data[a]}var c=this.getPkValue(b,this.getPrimaryKey());this.showConfirm(this.deleteConfirmMessage,this.deleteData.bind(this,c))}else{if(this.datagrid.selectedIndexs.length==0&&this.datagrid.selectedIndex==-1){this.showMessage("请从列表数据中至少选择一条需要删除的数据。",MSG_TYPE_WARNING)}else{this.showConfirm(this.deleteConfirmMessage,this.deleteData.bind(this))}}},onClick_RowSave:function(a){this.showErrorMessage("请在子类列表JS中实现onClick_RowSave方法。")},onClick_Audit:function(){if(this.datagrid.selectedIndexs.length==0&&this.datagrid.selectedIndex==-1){this.showMessage("请选择需要审核的数据",MSG_TYPE_WARNING)}else{this.showConfirm("确定要审核通过吗？",this.auditData.bind(this,1))}},onClick_SelectOk:function(){if(this.datagrid.selectedIndex<0&&this.datagrid.selectedIndexs.length==0){this.showMessage("请选择数据。",MSG_TYPE_WARNING);return}this.hide();if(this.isFunction(this.callback)){if(this.datagrid.selectedIndex!=-1){this.callback(this.datagrid.getSelectedRow())}else{this.callback(this.datagrid.getSelectedRows())}}},validateInputObject:function(){if(this.isEmpty(this.inputInstance)&&this.isEmpty(this.inputUrl)){alert("请设定this.inputInstance对象或this.inputUrl参数。");return false}return true},showDetail:function(a,c){var b=this.getRowData(a,c);this.detailInstance.inputEntity=$.extend(true,{},b);this.detailInstance.isDetail=true;if(this.isNotNull(this.getFrame())){this.detailInstance.parentFrame=this.getFrame()}if(this.isNotNull(this.parentFrame)){this.detailInstance.parentFrame=this.getDom(this.parentFrame)}this.detailInstance.show(this.refreshList.bind(this),1)},goDetail:function(a,d){if(this.validateInputObject()==false){return}var b=this.getRowData(a,d);var c=this.getPkValue(b,this.getPrimaryKey());this.showPageLoader();window.location=this.detailUrl+"?uid="+c},goInput:function(d,b,g){if(this.validateInputObject()==false){return}if(this.isNull(b)){b=0}var e=this.getRowData(d,g);if(this.isNotEmpty(this.inputInstance)){this.inputInstance.inputEntity=$.extend(true,{},e);this.inputInstance.listInstance=this;this.inputInstance.listDataIndex=d;this.inputInstance.isDetail=(b==1);var c=0;if(this.isNotNull(d)&&d>=0){c=1}this.inputInstance.inputEntity.editMode=c;if(this.isFunction(this.customInputParams)){this.customInputParams(c)}if(this.isNotNull(this.getFrame())){this.inputInstance.parentFrame=this.getFrame()}if(this.isNotNull(this.parentFrame)){this.inputInstance.parentFrame=this.getDom(this.parentFrame)}this.inputInstance.show(this.refreshList.bind(this),c)}else{var f=this.getPkValue(e,this.getPrimaryKey());var a="";if(b==2){b=1;a="&audit=1"}this.showPageLoader();if(this.inputUrl.indexOf("?")==-1){window.location=this.inputUrl+"?uid="+f+"&detail="+b+a}else{window.location=this.inputUrl+"&uid="+f+"&detail="+b+a}}},getRowData:function(a,b){if(this.isNull(b)){return this.datagrid.data[a]}else{return SysCmn.DataGridList[b].data[a]}},refreshList:function(){this.getList(false)},getSearchCondition:function(){return this.getSearchEntity()},prepareSearchEntityDateTime:function(b,a){if(this.isNotEmpty(this.searchEntity[b])&&this.searchEntity[b].length==10){this.searchEntity[b]+=" "+a}},getList:function(a,c){this.isSearchButtonClick=a;if(this.isNull(this.isSearchButtonClick)){this.isSearchButtonClick=false}if(this.isEmpty(c)){c=true}if(this.isFunction(this.customDomValue)){this.customDomValue()}if(this.existJsonListData()){this.restoreDefaultList();return}if(this.useSearchCondition){if(this.isSearchButtonClick){this.searchEntity=this.getSearchCondition();this.originalSearchEntity=jQuery.extend(true,{},this.searchEntity);this.datagrid.resetPageNum()}else{if(this.isConditionChanged(this.originalSearchEntity,this.getSearchCondition())){return}}}if(this.isFunction(this.customSearchEntity)){this.customSearchEntity()}var b=this.getSearchCommonParams(this.datagrid)+"&autoSaveSearchCondition="+this.autoSaveSearchCondition+"&isSearchButtonClick="+this.isSearchButtonClick+"&onlySearchButtonClickCountRecord="+this.onlySearchButtonClickCountRecord+"&selfInstance="+this.selfInstance;if(this.isFunction(this.customRequestParams)){b=b+"&"+this.customRequestParams()}if(c&&this.showProcessingMessage){this.showProcessing()}AjaxIns.sendPOST(this.controller+this.searchMethod,this.getListCallback.bind(this,c),b)},existJsonListData:function(){if(this.isNotNull($E(this.dom.jsonListData))&&this.isNotEmpty(this.getValue(this.dom.jsonListData))){return true}return false},restoreDefaultList:function(){this.searchEntity=this.getSearchCondition();this.originalSearchEntity=jQuery.extend(true,{},this.searchEntity);this.createList(this.getValue(this.dom.jsonListData));this.setValue(this.dom.jsonListData,"")},getListCallback:function(b,a){if($M.isAjaxFail(a.responseText)){return}if(this.createList(a.responseText)){if(b&&this.showProcessingMessage){this.hideMessage()}if(this.isPopupMode()&&this.isNull(this.parentFrame)){if(this.windowState=="normal"&&this.popupPosition!="top"){SysCmn.CtrlUtil.SetPopupPosition(this.getFrame(),this.popupPosition)}}}if(this.isFunction(this.createListAfter)){this.createListAfter()}},reCreateList:function(){this.colList=[];this.initDataGrid();this.createList(this.data)},createList:function(b){var a=b;if(typeof b=="string"){a=JsonUtility.Parse(b)}if(this.isNotEmpty(a.result)&&this.isNotEmpty(a.message)){this.showMessage(a.message,MSG_TYPE_ERROR);return false}this.data=a;if(this.isFunction(this.createListBefore)){this.createListBefore()}if(this.reInitTableColList){this.initDataGrid()}if(this.isFunction(this.cellCallback)){this.datagrid.init(this.dom.divList,a,this.colList,this.cellCallback.bind(this))}else{this.datagrid.init(this.dom.divList,a,this.colList)}if(this.isFunction(this.createCheckboxDisabledCallback)){this.datagrid.createCheckboxDisabledCallback=this.createCheckboxDisabledCallback.bind(this)}if(this.isFunction(this.customCreateList)){this.customCreateList(a)}else{this.datagrid.create()}this.datagrid.changePageCallback=this.getList.bind(this);this.datagrid.sortDataCallback=this.getList.bind(this);if(this.datagrid.allowResizeColumnWidth){initDataGridColumnResizeEvent(this.datagrid.tableId)}if(this.datagridForceHorizontalScroll){this.$("divDataGridScroll").addClass("data-grid-scroll")}else{if(this.isNotNull(this.myColumnSetting)){if(this.myColumnSetting.length>0){this.$("divDataGridScroll").addClass("data-grid-scroll")}else{this.$("divDataGridScroll").removeClass("data-grid-scroll")}}}this.bindMoneyInputEvent();this.bindPopoversEvent();return true},createDetailIcon:function(b){var a="<span class='popovers' data-trigger='hover' data-placement='top' data-content='详细'>";a+="<i class='fa fa-list fa-lg fa-blue fa-width-fixed' onclick='"+this.selfInstance+".goInput("+b+", 1);return false;'></i></a>";a+="</span>";return a},createEditIcon:function(b){var a="<span class='popovers' data-trigger='hover' data-placement='top' data-content='编辑'>";a+="<i class='fa fa-pencil fa-lg fa-blue fa-width-fixed' onclick='"+this.selfInstance+".goInput("+b+");return false;'></i></a>";a+="</span>";return a},createDeleteIcon:function(b){var a="<span class='popovers' data-trigger='hover' data-placement='top' data-content='删除'>";a+="<i onclick='"+this.selfInstance+".onClick_Delete("+b+");return false;' class='fa fa-trash-o fa-lg fa-blue fa-width-fixed'></i>";a+="</span>";return a},createSaveIcon:function(b){var a="<span class='popovers' data-trigger='hover' data-placement='top' data-content='保存'>";a+="<i onclick='"+this.selfInstance+".onClick_RowSave("+b+");return false;' class='fa fa-save fa-lg fa-green fa-width-fixed'></i>";a+="</span>";return a},createLockIcon:function(b){var a="<span class='popovers' data-trigger='hover' data-placement='top' data-content='停用'>";a+="<i class='fa fa-unlock fa-lg fa-blue fa-width-fixed' onclick='"+this.selfInstance+".onClick_UpdateStatus("+b+");return false;'></i></a>";a+="</span>";return a},createUnlockIcon:function(b){var a="<span class='popovers' data-trigger='hover' data-placement='top' data-content='启用'>";a+="<i class='fa fa-lock fa-lg fa-red fa-width-fixed' onclick='"+this.selfInstance+".onClick_UpdateStatus("+b+");return false;'></i></a>";a+="</span>";return a},createEditButton:function(c,b,a){if(b==true){return"<button type='button' class='btn btn-default"+this.getButtonClass(a)+"' disabled='true'><i class='fa fa-pencil fa-width-fixed'></i>编辑</button>"}return"<button type='button' class='btn btn-primary"+this.getButtonClass(a)+"' onclick='"+this.selfInstance+'.goInput("'+c+"\");return false;'><i class='fa fa-pencil fa-width-fixed'></i>编辑</button>"},createDeleteButton:function(c,b,a){if(this.isEmpty(a)){a="delete"}if(a!="delete"){a+=" delete"}if(b==true){return"<button type='button' class='btn btn-danger"+this.getButtonClass(a)+"' disabled='true'><i class='fa fa-trash-o fa-width-fixed'></i>删除</button>"}return"<button type='button' class='btn btn-danger"+this.getButtonClass(a)+"' onclick='"+this.selfInstance+".onClick_Delete("+c+");return false;'><i class='fa fa-trash-o fa-width-fixed'></i>删除</button>"},createDetailButton:function(d,c,b,a){if(this.isEmpty(a)){a="详细"}if(c==true){return"<button type='button' class='btn btn-default"+this.getButtonClass(b)+"' disabled='true'><i class='fa fa-list fa-width-fixed'></i>"+a+"</button>"}return"<button type='button' class='btn btn-default"+this.getButtonClass(b)+"' onclick='"+this.selfInstance+'.goInput("'+d+"\", 1);return false;'><i class='fa fa-list fa-width-fixed'></i>"+a+"</button>"},createLockButton:function(c,b,a){if(b==true){return"<button type='button' class='btn btn-danger"+this.getButtonClass(a)+"' disabled='true'><i class='fa fa-unlock fa-width-fixed'></i>停用</button>"}return"<button type='button' class='btn btn-danger"+this.getButtonClass(a)+"' onclick='"+this.selfInstance+".onClick_UpdateStatus("+c+");return false;'><i class='fa fa-unlock fa-width-fixed'></i>停用</button>"},getButtonClass:function(a){return this.isEmpty(a)?"":(" "+a)},createUnlockButton:function(c,b,a){if(this.isEmpty(a)){a=""}if(b==true){return"<button type='button' class='btn btn-default' disabled='true'><i class='fa fa-lock fa-width-fixed'></i>启用</button>"}return"<button type='button' class='btn btn-default' onclick='"+this.selfInstance+".onClick_UpdateStatus("+c+");return false;'><i class='fa fa-lock fa-width-fixed'></i>启用</button>"},createGroupButton:function(d,b,a){if(this.isNotEmpty(b)){var c=this.datagrid.getRowData(d);c.groupButton=b;return"<button type='button' onmouseover='"+this.selfInstance+".onMouseOver_GroupButton("+d+", this);return false;' onmouseout='"+this.selfInstance+".onMouseOut_GroupButton("+d+", this);return false;' class='btn btn-primary operation-group-button"+this.getButtonClass(a)+"'><i class='fa fa-cogs fa-width-fixed'></i>&nbsp;操作&nbsp;&nbsp;<span class='caret'></span></button>"}return""},onMouseOver_GroupButton:function(f,b){var e=this.datagrid.getRowData(f);$("#groupButtonDiv").html(e.groupButton);$(".operation-column-group-button").show();var d=$(b).offset().top;var c=$(b).offset().left;var g=$(window).height();var a=$("#groupButtonDiv").height();$(".operation-column-group-button").css("top",d+22);$(".operation-column-group-button").css("left",c-6);if((d+22+a)>g){$(".operation-column-group-button").css("top",d-a)}$(".operation-cross").css("top",d-5)},onMouseOut_GroupButton:function(){$(".operation-column-group-button").hide()},createDetailLink:function(b,a,c){if(this.isNull(this.detailInstance)){return b[a].escapeHTML()}else{return"<a href='#' class='detail-link' onclick='"+this.selfInstance+".showDetail("+c+");return false;'>"+b[a].escapeHTML()+"</a>"}},createRemarkColumn:function(c,a,b){if(this.isEmpty(a)){a="remark"}if(this.isEmpty(b)){b="备注"}var d="";if(this.isNotEmpty(c[a])){d="<span class='popovers' data-trigger='hover' data-placement='left' data-content='"+$M.enterToBr(c[a].escapeHTML())+"' data-original-title='"+b+"'>";d+="<i class='fa fa-comment fa-lg fa-blue'></i>";d+="</span>"}return d},onClick_UpdateStatus:function(b){var a=this.datagrid.data[b];if(a.recordStatus==1){this.showConfirm("确定要停用吗？",this.updateStatus.bind(this,a))}else{this.showConfirm("确定要启用吗？",this.updateStatus.bind(this,a))}},updateStatus:function(a){var b="uid="+a.uid+"&recordStatus="+a.recordStatus;if(this.showProcessingMessage){this.showProcessing(false)}AjaxIns.sendPOST(this.controller+"updateStatus",this.updateStatusCallback.bind(this),b)},updateStatusCallback:function(b){if($M.isAjaxFail(b.responseText)){return}var a=JsonUtility.Parse(b.responseText);if(a.result>0){this.refreshList()}else{this.showMessage(a.message,MSG_TYPE_ERROR)}}});SysCmn.CoreUtility=function(){};SysCmn.CoreUtility.isDateField=function(a){if($(a).data("date")==true){return true}return false};SysCmn.CoreUtility.isDateTimeField=function(a){if($(a).data("datetime")==true){return true}return false};SysCmn.CoreUtility.getAliasTableName=function(b){var a=$(b).data("alias-table");if($M.isEmpty(a)){a=""}else{a=a+"."}return a};SysCmn.CoreUtility.getCamelFieldFlag=function(b){var a=$(b).data("camel-field");if($M.isEmpty(a)||a==false||a=="false"){a=""}else{a=COL_CAMEL_FLAG}return a};SysCmn.CoreUtility.getFieldName=function(a,b){a=a+"_";return b.replaceAll(a,"")};SysCmn.CoreUtility.isLabel=function(b){try{var c=b.tagName.toUpperCase();if(c=="LABEL"||c=="SPAN"||c=="P"||c=="DIV"||c=="EM"||c=="TD"){return true}}catch(a){}return false};SysCmn.CoreUtility.isInputMoney=function(b){try{var c=b.tagName.toUpperCase();if(c=="LABEL"||c=="SPAN"||c=="P"||c=="DIV"||c=="EM"||c=="TD"){return false}if($(b).data("money")==true){return true}}catch(a){}return false};SysCmn.CoreUtility.setValue=function(b,d){if($M.isNull(b)){return false}var a=SysCmn.CoreUtility.isLabel(b);if(!$M.isNull(d)&&typeof d=="string"){d=$.trim(d)}if(SysCmn.CoreUtility.isDateField(b)){if(a){b.innerHTML=$M.isNull(d)?"":d.formatYMD()}else{b.value=$M.isNull(d)?"":d.formatYMD()}}else{if(SysCmn.CoreUtility.isDateTimeField(b)){if(a){b.innerHTML=$M.isNull(d)?"":d.formatYMDHMS()}else{b.value=$M.isNull(d)?"":d.formatYMDHMS()}}else{if($(b).data("money")==true){var c=$(b).data("precision");if(a){b.innerHTML=$M.formatCny(d,c)}else{b.value=$M.formatCny(d,c)}}else{if(a){if($(b).data("textarea")==true){b.innerHTML=$M.enterToBr(d)}else{b.innerHTML=d}}else{if(b.type=="select-one"){$(b).val(d)}else{if(b.type=="select-multiple"){if(d.indexOf(",")==0){d=d.substring(1)}$(b).val(d.split(","))}else{$(b).val(d)}}}}}}if(a&&$M.isEmpty(b.innerHTML)){b.innerHTML="&nbsp;"}return true};var MSG_TYPE_ERROR="-1";var MSG_TYPE_WARNING="0";var MSG_TYPE_INFO="1";var MSG_TYPE_PROCESSING="2";var MSG_TYPE_VALIDATION="3";var MSG_TYPE_CONFIRM="4";SysCmn.CmnMsgCls=Class.create();SysCmn.CmnMsgCls.prototype=Object.extend(new SysCmn.Core(),{initialize:function(){this.width=550;this.yesCallback=null;this.noCallback=null;this.cancelCallback=null;this.closeCallback=null;this.initCommonProperty()},init:function(){this.dom.ctlFrame=$E("ctlCmnMessageFrame");this.dom.ctlTitle=$E("ctlCmnMessageTitle");this.dom.ctlTitleName=$E("ctlCmnMessageTitleName");this.dom.btnYes=$E("btnYesForCmnMessage");this.dom.btnNo=$E("btnNoForCmnMessage");this.dom.btnCancel=$E("btnCancelForCmnMessage");this.dom.btnClose=$E("btnCloseForCmnMessage");this.dom.divMessage=$E("divCmnMessageMessage");this.dom.tdCmnMessageType=$E("tdCmnMessageType");this.dom.divCmnMessageFooter=$E("divCmnMessageFooter");$(this.getFrame()).css("position","absolute");this.bindEvent(this.dom.btnYes,"click",this.onClick_Yes.bind(this));this.bindEvent(this.dom.btnNo,"click",this.onClick_No.bind(this));this.bindEvent(this.dom.btnCancel,"click",this.onClick_Cancel.bind(this));this.bindEvent(this.dom.btnClose,"click",this.onClick_Close.bind(this));this.bindEvent($E("btnTopCloseForCmnMessage"),"click",this.onClick_Close.bind(this));this.bindEvent(this.dom.ctlTitle,"mousedown",function(a){SysCmn.DragDrop.Start(this.getFrame().id,a)}.bind(this))},onClick_Close:function(){this.hide();if(typeof this.closeCallback=="function"){this.closeCallback();this.closeCallback=null}return false},onClick_Yes:function(){if(typeof this.yesCallback=="function"){this.yesCallback();this.yesCallback=null}},onClick_No:function(){this.hide();if(typeof this.noCallback=="function"){this.noCallback();this.noCallback=null}return false},onClick_Cancel:function(){this.hide();if(typeof this.cancelCallback=="function"){this.cancelCallback();this.cancelCallback=null}return false},showMessage:function(c,d,a){$($E("btnTopCloseForCmnMessage")).show();if(window.processingMessageDisabled==true){return}c=$M.enterToBr(c);var f=navigator.userAgent.toLowerCase();if((f.match(/iphone/i)=="iphone"||f.match(/ipad/i)=="ipad")&&f.match(/MicroMessenger/i)=="micromessenger"){window.scrollTo(0,0)}this.closeCallback=a;if(String(this.width).indexOf("%")==-1){if(d==MSG_TYPE_PROCESSING){$(this.getFrame()).css("width","550px")}else{if(c.length>768){$(this.getFrame()).css("width","1000px")}else{if(c.length>512){$(this.getFrame()).css("width","850px")}else{if(c.length>256){$(this.getFrame()).css("width","700px")}else{$(this.getFrame()).css("width",this.width+"px")}}}}}else{$(this.getFrame()).css("width",this.width)}SysCmn.CtrlUtil.SetPopupPosition(this.getFrame(),this.popupPosition);if($(this.getFrame()).css("display")=="none"){SysCmn.EstopLayer.show(this.getFrame());if($M.isWeixinBrowser()){$(this.getFrame()).show();$(document.body).css("overflow","hidden")}else{$(this.getFrame()).fadeIn()}$(this.getFrame()).css("z-index",9999)}try{this._setMessage(c,d)}catch(b){}},showConfirm:function(b,d,c,a){this.yesCallback=d;this.noCallback=c;this.cancelCallback=a;this.showMessage(b,MSG_TYPE_CONFIRM)},showProcessing:function(a){if($M.isNull(a)){a=true}if($M.isWeixinBrowser()){this.showMessage("系统处理中，请耐心等待……",MSG_TYPE_PROCESSING)}else{this.showMessage("系统处理中，在此期间请勿刷新页面或关闭浏览器……",MSG_TYPE_PROCESSING)}if(a==false){$($E("btnTopCloseForCmnMessage")).hide()}},hide:function(a){if(window.processingMessageDisabled==true){return}if(a){this._hideCmnMessage()}else{this._hideCmnMessage()}},_setMessage:function(a,b){this.$(this.dom.divMessage).html(a);this.$(this.dom.btnYes).hide();this.$(this.dom.btnNo).hide();this.$(this.dom.btnCancel).hide();this.$(this.dom.btnClose).hide();this.$(this.dom.tdCmnMessageType).show();$(".cmn-message-icon").hide();this.$(this.dom.divCmnMessageFooter).show();if(b==MSG_TYPE_ERROR){this.$(this.dom.divMessage).css("color","red");$(".fa-warning").show();this.$(this.dom.btnClose).show();this.dom.btnClose.focus()}else{if(b==MSG_TYPE_WARNING){this.$(this.dom.divMessage).css("color","red");$(".fa-warning").show();this.$(this.dom.btnClose).show();this.dom.btnClose.focus()}else{if(b==MSG_TYPE_INFO){this.$(this.dom.divMessage).css("color","#767676");$(".fa-info-circle").show();this.$(this.dom.btnClose).show();this.dom.btnClose.focus()}else{if(b==MSG_TYPE_PROCESSING){this.$(this.dom.divCmnMessageFooter).hide();this.$(this.dom.divMessage).css("color","#767676");$(".fa-spinner").show()}else{if(b==MSG_TYPE_VALIDATION){this.$(this.dom.divMessage).css("color","red");this.$(this.dom.tdCmnMessageType).hide();this.$(this.dom.btnClose).show();this.dom.btnClose.focus()}else{if(b==MSG_TYPE_CONFIRM){this.$(this.dom.divMessage).css("color","#767676");$(".fa-question-circle-o").show();this.$(this.dom.btnYes).show();this.$(this.dom.btnNo).show();if(this.cancelCallback!=null){this.$(this.dom.btnCancel).show()}this.dom.btnYes.focus()}}}}}}SysCmn.CtrlUtil.SetPopupPosition(this.getFrame(),this.popupPosition)},_hideCmnMessage:function(){SysCmn.EstopLayer.hide(this.getFrame());if($M.isWeixinBrowser()){$(document.body).css("overflow","auto");$(this.getFrame()).hide()}else{$(this.getFrame()).fadeOut()}},setWidth:function(a){this.width=a},setTitle:function(a){this.$(this.dom.ctlTitleName).html(a)}});SysCmn.CmnMsg=new SysCmn.CmnMsgCls();