SysApp.Cmn.AutoComplete=Class.create();SysApp.Cmn.AutoComplete.prototype=Object.extend(new SysCmn.Core(),{initialize:function(){this.initCommonProperty()},init:function(){var thisObj=this;this.$(this.selectLabel).blur(function(){if(this.value==""){thisObj.setValue(thisObj.selectId,"")}});this.$(this.selectLabel).autocomplete({minLength:thisObj.searchMinLength,source:function(request,response){$.ajax({url:thisObj.url+"?ajaxTime="+new Date().getTime(),type:"post",async:false,data:thisObj.paramName+"="+request.term,dataType:"json",success:function(ajaxResult){response(ajaxResult.content);var callback=eval(thisObj.autoCompleteSuccessCallback);var pageInstance=eval(thisObj.pageInstance);if(pageInstance.isFunction(callback)){callback.call(pageInstance,ajaxResult.content)}else{if(thisObj.isEmpty(ajaxResult.content)){thisObj.setValue(thisObj.selectId,"")}}}})},select:function(event,ui){var callback=eval(thisObj.autoCompleteSelectCallback);var pageInstance=eval(thisObj.pageInstance);if(pageInstance.isFunction(callback)){callback.call(pageInstance,event,ui)}else{thisObj.setValue(thisObj.selectLabel,ui.item.label);thisObj.setValue(thisObj.selectId,ui.item.uid)}event.preventDefault()}})}});SysApp.Cmn.BrowserVersion=Class.create();SysApp.Cmn.BrowserVersion.prototype=Object.extend(new SysCmn.CoreInput(),{getPrimaryKey:function(){return"uid"},initCallback:function(){this.bindPopoversEvent()},show:function(){if($M.isIE7()||$M.isIE8()||$M.isIE9()){SysCmn.EstopLayer.show(this.getFrame());$(this.getFrame()).fadeIn();SysCmn.CtrlUtil.SetPopupPosition(this.getFrame(),"center");$(this.getFrame()).css("z-index",99999)}}});SysApp.Cmn.ColumnSetting=Class.create();SysApp.Cmn.ColumnSetting.prototype=Object.extend(new SysCmn.CoreInput(),{getPrimaryKey:function(){return"uid"},initCallback:function(){this.instanceString=this.pageInstance;this.showSaveDataSuccessMessage=false;this.setValue("pageInstance",this.pageInstance);if(this.isNotEmpty(this.width)){$(this.getFrame()).width(this.width)}},customSaveDataCallback:function(){this.pageInstance.colList=new Array();this.pageInstance.initTableColList();this.pageInstance.initColumnSetting();this.pageInstance.createList(this.pageInstance.data)},customSaveConfirmMessage:function(){var a=false;$(".column-setting-list").each(function(){if(this.checked){a=true}});if(a==false){return"您未选择任何列信息，将自动恢复默认显示方式，<br />确定要保存吗？"}else{return"确定要保存吗？"}},initInputFormBefore:function(){},initInputFormAfter:function(){this.$("ctlTitle").html("显示列设定");this.pageInstance=eval(this.pageInstance);this.allColList=this.pageInstance.allColList;this.myColumnSetting=this.pageInstance.myColumnSetting;$(this.getDom("columnSettingList")).empty();var thisObj=this;if(this.allColList){$.each(this.allColList,function(index,item){if(!item.onlyForExport){thisObj.appendColumnItem(item)}})}$(this.getDom("columnSettingList")).append('<div style="clear:both;"><input id="checkAllColumnSetting" type="checkbox"/><label for="checkAllColumnSetting">全选择/全解除</label>（<i class="fa fa-hand-o-right warning-red margin-top-space">&nbsp;全解除状态，将自动恢复系统默认列显示方式。</i>）</div>');$("#checkAllColumnSetting").click(function(){var checked=this.checked;$(".column-setting-list").each(function(){this.checked=checked})})},appendColumnItem:function(d){var a="";if(this.isNotEmpty(this.myColumnSetting)&&this.myColumnSetting.length>0){$.each(this.myColumnSetting,function(){if(this==d.colName){a='checked="checked"'}})}else{var b=this.pageInstance.colList;$.each(b,function(){if(this.colName==d.colName){a='checked="checked"'}})}var c='<div style="width:182px;float: left;text-overflow:ellipsis;overflow: hidden;"><input class="column-setting-list" id="'+d.colName+'" type="checkbox" '+a+'"/><label for="'+d.colName+'">'+d.title.replaceAll(" ","").replaceAll("<br/>","/")+"</label></div>";$(this.getDom("columnSettingList")).append(c)},customInputEntity:function(){this.inputEntity=new Object();this.inputEntity.pageInstance=this.getValue("pageInstance");this.inputEntity.settingType=this.isEmpty(this.settingType)?"1":this.settingType;var b=[];var a=$(this.getDom("columnSettingList"));$(".column-setting-list").each(function(){if(this.checked){b.push(this.id)}});this.inputEntity.parameters=JSON.stringify(b);this.myColumnSetting=b;if(this.isNotEmpty(this.pageMode)){this.inputEntity.pageInstance=this.instanceString+"_"+this.pageMode}this.pageInstance.setValue("jsonColumnSetting",this.inputEntity.parameters)},validateFormBefore:function(){return true},customRequestParams:function(){return""}});SysApp.Cmn.ComboTree=Class.create();SysApp.Cmn.ComboTree.prototype=Object.extend(new SysCmn.Core(),{initialize:function(){this.initCommonProperty();this.initCalendarFlag=false},initParentInstance:function(a){this._initParentInstance();if(this.isNull(a)){this.parentInterval=setInterval(this._initParentInstance.bind(this),10)}},_initParentInstance:function(){if(this.isNotNull(eval(this.parentInstanceString))){clearInterval(this.parentInterval);this.parentInstance=eval(this.parentInstanceString);eval(this.parentInstanceString+"."+this.valueDomId+"ComboTree = this;");this.clientID=this.parentInstance.getClientID();this.initCombo()}},getTreeId:function(){return this.getId(this.valueDomId+"Tree")},initCombo:function(b,a){this.readonly=false;if(this.isNotEmpty(a)){this.readonly=a}if(this.isEmpty(b)){this.selectedValue=""}else{this.selectedValue=b}if(this.isEmpty(this.ajaxUrl)){this.initComboByOptionList()}else{this.initComboByAjax()}Event.observe(window.document,"click",this.onBodyDown.bind(this))},initComboByOptionList:function(){$.fn.zTree.init(this.$(this.getTreeId()),{view:{dblClickExpand:false},data:{key:{name:this.dispName},simpleData:{enable:true,idKey:this.idKey,pIdKey:this.parentIdKey,}},callback:{beforeClick:this.beforeClick.bind(this),onAsyncSuccess:this.zTreeOnAsyncSuccess.bind(this),onClick:this.onClick.bind(this)}},this.getTreeNodes());var b=$.fn.zTree.getZTreeObj(this.getTreeId());var a=b.getNodes();if(a.length>0){b.expandNode(a[0],true,true);this.selectNodeItem(this.getValue(this.valueDomId))}},getTreeNodes:function(){var e=this.parentInstance.getValue("jsonOptionList");var f=new Array();var c={};c.subCd="";c.parentSubCd="";c.subName="全部";f.push(c);if(this.isEmpty(e)){return f}var b=JsonUtility.Parse(e);var a=b[(this.valueDomId)];var d=this;$.each(a,function(g,h){if(d.isEmpty(h.parentSubCd)){h.parentSubCd=c.subCd}f.push(h)});return f},initComboByAjax:function(){var b=new Date().getTime();var c=(this.ajaxUrl.indexOf("?")==-1)?(this.ajaxUrl+"?ajaxTime="+b):(this.ajaxUrl+"&ajaxTime="+b);var a={};if(this.isNotEmpty(this.parentDomId)&&this.isNotEmpty(this.parentValue)){a.parentUids=this.parentValue}$.fn.zTree.init(this.$(this.getTreeId()),{view:{dblClickExpand:false},async:{enable:true,type:"post",dataType:"json",otherParam:a,url:c,autoParam:[]},data:{key:{name:this.nodeName},simpleData:{enable:true,idKey:this.idKey,pIdKey:this.parentIdKey,rootPid:""}},callback:{beforeClick:this.beforeClick.bind(this),onAsyncSuccess:this.zTreeOnAsyncSuccess.bind(this),onClick:this.onClick.bind(this)}},null)},beforeClick:function(a,b){if(this.isNotEmpty(this.disabledLevel)&&this.disabledLevel.indexOf(b.level)>=0){return false}else{if(this.allowSelectParent==false){if(b.isParent){return false}}}return true},zTreeOnAsyncSuccess:function(a,d,e,b){var f=$.fn.zTree.getZTreeObj(this.getTreeId());var c=f.getNodes();if(c.length>0){f.expandNode(c[0],true,true);this.selectNodeItem(this.selectedValue)}this.setReadOnly(this.readonly);this.setLeafIcon(c);f.refresh();if(this.isFunction(this.parentInstance.initTreeCallback)){this.parentInstance.initTreeCallback(this)}},setLeafIcon:function(c){for(var a=0,b=c.length;a<b;a++){var d=c[a];if(d.isParent){this.setLeafIcon(d.children)}else{if(this.isNotEmpty(d.isPerson)&&d.isPerson==true){d.icon=window.imagesPath+"base/person.png"}else{if(this.isNotEmpty(d.isDept)&&d.isDept==true){}}}}},onClick:function(b,j,k){if(this.readonly){return}var m=$.fn.zTree.getZTreeObj(this.getTreeId());var f=m.getSelectedNodes();var h="";var g="";f.sort(function a(e,i){return e[this.idKey]-i[this.idKey]});for(var c=0,d=f.length;c<d;c++){h+=f[c][this.dispName]+",";g+=f[c][this.idKey]+","}if(h.length>0){h=h.substring(0,h.length-1);g=g.substring(0,g.length-1)}this.setValue(this.textDomId,h);this.setValue(this.valueDomId,g);if(this.isFunction(this.parentInstance.onComboSelected)){this.parentInstance.onComboSelected(g,h,k)}this.hideMenu()},showMenu:function(){var a=$($(".combo-tree-"+this.uniqueID).get(0)).width();a=a-12;this.$(this.getTreeId()).width(a+"px");if(this.readonly){return}if(this.isNotEmpty(this.parentDomId)){this.parentValue=this.getValue(this.parentDomId);if(this.isEmpty(this.parentValue)){this.setValue(this.valueDomId,"");this.showErrorMessage("请先选择"+this.parentDataTitle);this.hideMenu();return}else{this.inited=false;this.initParentInstance(true)}}if(this.isNotEmpty(this.ajaxUrl)&&this.reloadFlag=="true"){this.initComboByAjax()}this.$(this.valueDomId+"MenuContent").slideDown("fast")},hideMenu:function(){if(this.readonly){return}this.$(this.valueDomId+"MenuContent").fadeOut("fast")},onBodyDown:function(a){if(this.readonly){return}var c=this.getId(this.valueDomId);var b=this.getId(this.textDomId);if(!(a.target.id==c+"MenuBtn"||a.target.id==c+"FaMenuBtn"||a.target.id==b||a.target.id==c+"MenuContent"||this.$(a.target).parents("#"+c+"MenuContent").length>0)){this.hideMenu()}},selectNodeItem:function(d){if(this.isEmpty(d)){return}else{var e=$.fn.zTree.getZTreeObj(this.getTreeId());this.setValue(this.valueDomId,d);var c=e.getNodes();if(c.length>0){for(var a=0,b=c.length;a<b;a++){this.selectSpecNode(e,c[a],d)}}}},selectSpecNode:function(g,f,e){if(f.isParent){if(f[this.idKey]==e){var c=this.getValue(this.textDomId);c=f[this.dispName];this.setValue(this.textDomId,c);g.selectNode(f,false,false);return}var d=f.children;for(var a=0,b=d.length;a<b;a++){this.selectSpecNode(g,d[a],e)}}else{if(f[this.idKey]==e){var c=this.getValue(this.textDomId);c=f[this.dispName];this.setValue(this.textDomId,c);g.selectNode(f,false,false);return}return}},setReadOnly:function(a){this.readonly=a}});SysApp.Cmn.ComboCheckTree=Class.create();SysApp.Cmn.ComboCheckTree.prototype=Object.extend(new SysCmn.Core(),{initialize:function(){this.initCommonProperty();this.initCalendarFlag=false;this.inited=false},initParentInstance:function(a){this._initParentInstance();if(this.isNull(a)){this.parentInterval=setInterval(this._initParentInstance.bind(this),10)}},_initParentInstance:function(){if(this.isNotNull(eval(this.parentInstanceString))){clearInterval(this.parentInterval);this.parentInstance=eval(this.parentInstanceString);eval(this.parentInstanceString+"."+this.valueDomId+"ComboTree = this;");this.clientID=this.parentInstance.getClientID();this.initComboCheck()}},getTreeId:function(){return this.getId(this.valueDomId+"Tree")},initComboCheck:function(a,b){if(this.isEmpty(a)){this.parentCheck=true}else{this.parentCheck=a}this.readonly=false;if(this.isNotEmpty(b)){this.readonly=b}if(this.inited==true){return}if(this.isEmpty(this.ajaxUrl)){this.initComboByOptionList()}else{this.initComboByAjax()}Event.observe(window.document,"click",this.onBodyDown.bind(this))},initComboByOptionList:function(){$.fn.zTree.init(this.$(this.getTreeId()),{check:{enable:true,chkboxType:{Y:"ps",N:"ps"}},view:{dblClickExpand:false},data:{key:{name:this.dispName},simpleData:{enable:true,idKey:this.idKey,pIdKey:this.parentIdKey,}},callback:{beforeClick:this.beforeClick.bind(this),onCheck:this.onCheck.bind(this)}},this.getTreeNodes());var b=$.fn.zTree.getZTreeObj(this.getTreeId());var a=b.getNodes();if(a.length>0){b.expandNode(a[0],true,true);this.checkNodes(b)}},initComboByAjax:function(){var c=new Date().getTime();var d=(this.ajaxUrl.indexOf("?")==-1)?(this.ajaxUrl+"?ajaxTime="+c):(this.ajaxUrl+"&ajaxTime="+c);if(this.isFunction(this.parentInstance.customDataUrlParams)&&this.reloadFlag=="true"){var b=this.parentInstance.customDataUrlParams();if(this.previousCustomDataUrlParams==b){return}this.previousCustomDataUrlParams=b;d+="&"+b}var a={};if(this.isNotEmpty(this.parentDomId)&&this.isNotEmpty(this.parentValue)){a.parentUids=this.parentValue}$.fn.zTree.init(this.$(this.getTreeId()),{check:{enable:true,chkboxType:{Y:"ps",N:"ps"}},view:{dblClickExpand:false},async:{enable:true,type:"post",dataType:"json",otherParam:a,url:d,autoParam:[]},data:{key:{name:this.nodeName},simpleData:{enable:true,idKey:this.idKey,pIdKey:this.parentIdKey,}},callback:{beforeClick:this.beforeClick.bind(this),onAsyncSuccess:this.zTreeOnAsyncSuccess.bind(this),onCheck:this.onCheck.bind(this)}},null)},beforeClick:function(a,b){return false},zTreeOnAsyncSuccess:function(a,f,g,d){var h=$.fn.zTree.getZTreeObj(this.getTreeId());var e=h.getNodes();if(e.length>0){h.expandNode(e[0],true,true);if(!this.parentCheck){for(var b=0,c=e.length;b<c;b++){this.setParentNoCheck(e[b])}}this.setReadOnly(this.readonly);this.checkNodes(h);this.setLeafIcon(e)}h.refresh();this.disabledNodes(h);this.inited=true;if(this.isFunction(this.parentInstance.initTreeCallback)){this.parentInstance.initTreeCallback(this)}},disabledNodes:function(e){if(this.isNotEmpty(this.disabledLevel)){var d=this.disabledLevel.split(",");for(var b=0;b<d.length;b++){var a=e.getNodesByParam("level",parseInt(d[b]));for(var c=0;c<a.length;c++){e.setChkDisabled(a[c],true);a[c].nocheck=true;e.updateNode(a[c])}}}},setLeafIcon:function(c){for(var a=0,b=c.length;a<b;a++){var d=c[a];if(d.isParent){this.setLeafIcon(d.children)}else{if(this.isNotEmpty(d.isPerson)&&d.isPerson==true){d.icon=window.imagesPath+"base/person.png"}else{if(this.isNotEmpty(d.isDept)&&d.isDept==true){}}}}},onCheck:function(a,h,j){if(this.readonly){return}var k=$.fn.zTree.getZTreeObj(this.getTreeId());var d=k.getCheckedNodes(true);var f="";var g="";for(var b=0,c=d.length;b<c;b++){if(this.canCheckParent=="true"||!d[b].isParent){f+=d[b][this.dispName]+",";g+=d[b][this.idKey]+","}}if(f.length>0){f=f.substring(0,f.length-1);g=g.substring(0,g.length-1)}this.setValue(this.textDomId,f);this.setValue(this.valueDomId,g);if(this.isFunction(this.parentInstance.onCheck)){this.parentInstance.onCheck(f,g,j)}},showMenu:function(){var a=$($(".combo-tree-"+this.uniqueID).get(0)).width();a=a-12;if(this.isNotEmpty(this.comboTreeWidth)){a=this.comboTreeWidth}this.$(this.getTreeId()).width(a+"px");if(this.readonly){return}if(this.isNotEmpty(this.parentDomId)){this.parentValue=this.getValue(this.parentDomId);if(this.isEmpty(this.parentValue)){this.setValue(this.valueDomId,"");this.showErrorMessage("请先选择"+this.parentDataTitle);this.hideMenu();return}else{this.inited=false;this.initParentInstance(true)}}if(this.isNotEmpty(this.ajaxUrl)&&this.reloadFlag=="true"){this.initComboByAjax()}this.$(this.valueDomId+"MenuContent").slideDown("fast")},hideMenu:function(){if(this.readonly){return}this.$(this.valueDomId+"MenuContent").fadeOut("fast")},onBodyDown:function(a){if(this.alwaysShowTree=="true"){return}if(this.readonly){return}var c=this.getId(this.valueDomId);var b=this.getId(this.textDomId);if(!(a.target.id==c+"MenuBtn"||a.target.id==c+"FaMenuBtn"||a.target.id==b||a.target.id==c+"MenuContent"||this.$(a.target).parents("#"+c+"MenuContent").length>0)){this.hideMenu()}},checkNodes:function(f){if(this.isEmpty(f)){f=$.fn.zTree.getZTreeObj(this.getTreeId())}var c=f.getNodes();if(this.isEmpty(this.getValue(this.valueDomId+"DefaultSelectedNode"))){var d=this.getValue(this.valueDomId);if(this.isEmpty(d)){return}this.setValue(this.textDomId,"");var e=d.split(",");for(var a=0,b=c.length;a<b;a++){this.selectSpecNode(f,c[a],e)}}else{for(var a=0,b=c.length;a<b;a++){this.selectParentNode(f,c[a])}}},selectParentNode:function(e,d){if(d[this.idKey]==this.getValue(this.valueDomId+"DefaultSelectedNode")){e.checkNode(d,true,true);this.selectSpecNode(e,d)}else{if(d.isParent){var c=d.children;for(var a=0,b=c.length;a<b;a++){this.selectParentNode(e,c[a])}}}},selectSpecNode:function(m,h,k){if(h.isParent){var g=h.children;for(var a=0,e=g.length;a<e;a++){this.selectSpecNode(m,g[a],k)}}else{if(this.isNull(k)){var f=this.getValue(this.textDomId);var b=this.getValue(this.valueDomId);if(this.isEmpty(f)){f=h[this.dispName];b=h[this.idKey]}else{f=f+","+h[this.dispName];b=b+","+h[this.idKey]}this.setValue(this.textDomId,f);this.setValue(this.valueDomId,b)}else{for(var c=0,d=k.length;c<d;c++){if(h[this.idKey]==k[c]){var f=this.getValue(this.textDomId);if(this.isEmpty(f)){f=h[this.dispName]}else{f=f+","+h[this.dispName]}this.setValue(this.textDomId,f);m.checkNode(h,true,false);break}}return}}},setParentNoCheck:function(d){if(d.isParent){d.nocheck=true;var a=d.children;for(var b=0,c=a.length;b<c;b++){this.setParentNoCheck(a[b])}}else{return}},setReadOnly:function(a){this.readonly=a},getTreeNodes:function(){var e=this.parentInstance.getValue("jsonOptionList");var f=new Array();var d={};d.subCd="";d.parentSubCd="";d.subName="全部";f.push(d);if(this.isEmpty(e)){return f}var c=JsonUtility.Parse(e);var b=this.idKey;var a=c[(this.valueDomId)];$.each(a,function(g,h){if(b=="subName"){h.parentSubCd=d.subName}else{h.parentSubCd=d.subCd}f.push(h)});return f},checkAllNodes:function(a){$.fn.zTree.getZTreeObj(this.getTreeId()).checkAllNodes(a)}});SysApp.Cmn.DeptComboCheckTree=Class.create();SysApp.Cmn.DeptComboCheckTree.prototype=Object.extend(new SysCmn.CoreInput(),{initParentInstance:function(a){this._initParentInstance();if(this.isNull(a)){this.parentInterval=setInterval(this._initParentInstance.bind(this),10)}},_initParentInstance:function(){if(this.isNotNull(eval(this.parentInstanceString))){clearInterval(this.parentInterval);this.parentInstance=eval(this.parentInstanceString)}},});SysApp.Cmn.Header=Class.create();SysApp.Cmn.Header.prototype=Object.extend(new SysCmn.Core(),{initialize:function(){this.initCommonProperty();this.initCalendarFlag=false},init:function(){this.bindEvent(window.document,"click",this.closeSubMenu.bind(this));this.bindEvent("main-content","mouseover",this.closeSubMenu.bind(this));var a=this;$(".top-main-menu").click(function(b){a.showSubMenu($(this).attr("sub_menu"))});$(".top-main-menu").mousemove(function(b){a.showSubMenu($(this).attr("sub_menu"))});$(".header-notice-message").click(function(){a.showMessageDetailPopupList()});$(".popup-prompt-head i").click(function(){$(".popup-prompt").slideUp()});this.initDwr()},initDwr:function(){try{dwr.engine.setActiveReverseAjax(true);dwr.engine.setNotifyServerOnPageUnload(true);this.onPageLoad()}catch(a){}},onPageLoad:function(){MessagePushService.onPageLoad(this.userUid);this.getUnreadCount()},getUnreadCount:function(){AjaxIns.sendPOST(this.getUnreadCountController,this.getUnreadCountCallback.bind(this))},getUnreadCountCallback:function(b){if($M.isAjaxFail(b.responseText)){return}var a=JsonUtility.Parse(b.responseText);this.setUnreadCount(a.content)},setUnreadCount:function(a){if(parseInt(a)>=100){$("#spanUnreadCounts").html("99+")}else{$("#spanUnreadCounts").html(a)}},showNoticeMessage:function(a){var b=JsonUtility.Parse(a);if(this.isNotEmpty(b)&&this.isNotEmpty(b.uid)){$(".popup-prompt-title").html(b.messageTitle);$(".popup-prompt-content").html(b.messageContent);$(".popup-prompt").slideDown();setTimeout(function(){$(".popup-prompt").slideUp()},15000);this.setUnreadCount(b.currentUserUnreadCount)}},showSubMenu:function(a){this.closeSubMenu();$(a).show();return false},closeSubMenu:function(){$(".personal-setting").hide();$(".top-menu-report").hide()},showMessageDetailPopupList:function(){this.messageDetailPopupIns=SysApp.Cmn.MessageDetailPopupListIns;this.messageDetailPopupIns.show();this.messageDetailPopupIns.getList(true)}});SysApp.Cmn.Help=Class.create();SysApp.Cmn.Help.prototype=Object.extend(new SysCmn.CoreInput(),{getPrimaryKey:function(){return"uid"},initCallback:function(){this.popupPosition="firstTop";this.instanceString=this.pageInstance;this.bindEvent("btnEdit","click",this.onClick_Edit.bind(this))},showCallback:function(){$(this.getFrame()).width($M.getClientWidth()-100);$(this.getFrame()).css("left","50px");this.$("divParameters").height($M.getClientHeight()-145);if(!this.isItSupport&&!this.isSystemManagement){this.$("divParameters").css("overflow-y","auto");this.$("divParameters").html(this.inputEntity.parameters);return}var a=this.isNotNull(this.editor.parameters)?this.editor.parameters.getContent():this.inputEntity.parameters;if(this.isNotNull(this.editor.parameters)){UE.delEditor("parameters")}this.$("divParameters").html("<textarea id='parameters'></textarea>");this.$("parameters").val(a);this.initUEditor("parameters");var b=this;this.editor.parameters.addListener("ready",function(){this.setHeight($M.getClientHeight()-145);if(b.isHelpEditMode){this.setEnabled();$(".edui-editor-toolbarboxouter").show();$(".edui-editor-bottomContainer").show();this.setHeight(this.container.clientHeight-5)}else{this.setDisabled();$(".edui-editor-toolbarboxouter").hide();$(".edui-editor-bottomContainer").hide()}})},initInputFormBefore:function(){},initInputFormAfter:function(){this.$("Help_ctlTitle").html("操作说明");if(!this.isHelpEditMode){this.displayDom("btnSave",false)}},onClick_Edit:function(){this.displayDom("btnSave",true);this.displayDom("btnEdit",false);this.editor.parameters.enable();$(".edui-editor-toolbarboxouter").show();$(".edui-editor-bottomContainer").show();this.isHelpEditMode=true;this.editor.parameters.setHeight(this.editor.parameters.container.clientHeight-200)},windowMaximizationCallback:function(a){if(a){if(this.isHelpEditMode){this.editor.parameters.setHeight($M.getClientHeight()-140-80)}else{this.editor.parameters.setHeight($M.getClientHeight()-140)}}else{if(this.isHelpEditMode){this.editor.parameters.setHeight(this.windowProperty.height-140-100)}else{this.editor.parameters.setHeight(this.windowProperty.height-140)}}},customInputEntity:function(){this.inputEntity.parameters=this.editor.parameters.getContent();this.inputEntity.pageInstance=this.instanceString;if(this.isNotEmpty(this.pageMode)){this.inputEntity.pageInstance=this.instanceString+"_"+this.pageMode}this.inputEntity.settingType="4"},validateFormBefore:function(){return true},validateFormAfter:function(){return true},customRequestParams:function(){return""},saveDataCallback:function(b){if($M.isAjaxFail(b.responseText)){return}var a=JsonUtility.Parse(b.responseText);if(a.result==-1){this.showMessage(a.message,MSG_TYPE_ERROR)}else{SysCmn.CmnMsg.hide(true)}this.displayDom("btnEdit",true);this.displayDom("btnSave",false);this.editor.parameters.disable();$(".edui-editor-toolbarboxouter").hide();$(".edui-editor-bottomContainer").hide();this.isHelpEditMode=false;this.editor.parameters.setHeight(this.editor.parameters.container.clientHeight+100)}});$(function(){if($.fn.dcAccordion){$("#nav-accordion").dcAccordion({eventType:"click",autoClose:true,saveState:true,disableLink:true,speed:"fast",showCount:false,autoExpand:true,classExpand:"dcjq-current-parent"})}if($.cookie("left_menu_expanded")=="true"){$(".sidebar").toggleClass("left-menu-mini");$(".sidebar-expand>a>i").toggleClass("mini-icon-shut mini-icon-open")}var a=$(window).height();$(".sidebar-border").height(a-50);$(".wrapper").height(a-80);$(".sidebar-expand").click(function(){$(".sidebar").toggleClass("left-menu-mini");$(".sidebar-expand>a>i").toggleClass("mini-icon-shut mini-icon-open");var b=$(this).parentsUntil("sidebar").hasClass("left-menu-mini");$.cookie("left_menu_expanded",b)});$(".dcjq-parent").click(function(){$(".dcjq-parent").each(function(){$("i",this).addClass("fa-caret-right");$("i",this).removeClass("fa-caret-down")});if($(this).hasClass("active")){$("i",this).addClass("fa-caret-down");$("i",this).removeClass("fa-caret-right")}});$(".dcjq-parent").each(function(){if($(this).hasClass("active")){$("i",this).addClass("fa-caret-down");$("i",this).removeClass("fa-caret-right")}else{$("i",this).addClass("fa-caret-right");$("i",this).removeClass("fa-caret-down")}});$(".sidebar-menu li a").mouseover(function(){var b=$(this).children("span").text();var c=$(this).offset().top;$(".sidebar-nav-prompt em").text(b).parent().css("top",c+3).show();if($(".sidebar").hasClass("left-menu-mini")){$(".sidebar-nav-prompt").css("left","55px")}else{$(".sidebar-nav-prompt").css("left","155px")}});$(".sidebar-menu li a").mouseout(function(){$(".sidebar-nav-prompt").hide()});$(".sidebar-sub-menu ol").hide().prev("a").css("cursor","default").find("i").removeClass("fa-angle-down").addClass("fa-angle-right");$(".sidebar-sub-menu ol li.active").parents("ol").show().prev("a").find("i").removeClass("fa-angle-right").addClass("fa-angle-down");$(".sidebar-sub-menu li li a").click(function(){if($(this).next("ol").css("display")=="none"){$(this).next("ol").slideDown();$(this).find("i").removeClass("fa-angle-right").addClass("fa-angle-down")}else{if($(this).next("ol").css("display")=="block"){$(this).next("ol").slideUp();$(this).find("i").removeClass("fa-angle-down").addClass("fa-angle-right")}}})});SysTabMultiViewClientClass=function(b,d,a){this.controlId=b;this.tabCount=d;this.autoAdjustTabWidth=a;this.data={TabsId:this.controlId+"_Tabs",ViewsId:this.controlId+"_Views",ActiveViewIndex:0,CssClass:"tmv-customize",DefaultViewCssClassTag:"Customize",TabViewCssClasses:[{Tag:"Customize",EnableOut:"enableout",EnableOver:"enableover",Active:"active",Unable:"unable"}],TabViews:[]};for(var c=0;c<this.tabCount;c++){this.data.TabViews.push({TabId:this.controlId+"_Tab"+c,ViewId:this.controlId+"_View"+c,CssClassTag:"",Unable:false})}this.OnActiveViewChanged=null;this._unboxJsonData();this.adjustTabWidth();this.bindEvent()};SysTabMultiViewClientClass.prototype={State:{EnableOut:"1",EnableOver:"2",Active:"3",Unable:"4",isValid:function(a){if(a==this.EnableOut||a==this.EnableOver||a==this.Active||a==this.Unable){return true}else{return false}},initialize:function(a,b){this.cssClasses=a;this.defaultTag=b},getCssClass:function(f,e){function c(j,i){var h="";switch(i){case this.EnableOut:h=j.EnableOut;break;case this.EnableOver:h=j.EnableOver;break;case this.Active:h=j.Active;break;case this.Unable:h=j.Unable;break}return(!!h)?h:""}var a="";var b=-1,g=-1;for(var d=0;d<this.cssClasses.length;d++){if(this.cssClasses[d].Tag==this.defaultTag){b=d}if(this.cssClasses[d].Tag==f){g=d}}if(g!=-1){a=c.apply(this,[this.cssClasses[g],e])}if(!a&&b!=-1){a=c.apply(this,[this.cssClasses[b],e])}return a}},_onViewMouseover:function(a){var b=parseInt(a,10);if(this.data.TabViews[b].Unable||this.data.ActiveViewIndex==b){return false}this._setViewState(this.State.EnableOver,b)},_onViewMouseout:function(a){var b=parseInt(a,10);if(this.data.TabViews[b].Unable||this.data.ActiveViewIndex==b){return false}this._setViewState(this.State.EnableOut,b)},_onActiveViewChanged:function(a){var b=parseInt(a,10);this.setViewActive(b)},_boxJsonData:function(){var a=JsonUtility.ToJSON(this.data)},_unboxJsonData:function(){this.State.initialize(this.data.TabViewCssClasses,this.data.DefaultViewCssClassTag);for(var a=0;a<this.data.TabViews.length;a++){if(this.data.TabViews[a].Unable){this._setViewState(this.State.Unable,a)}else{if(this.data.ActiveViewIndex==a){this._setViewState(this.State.Active,a)}else{this._setViewState(this.State.EnableOut,a)}}}},_getViewByDom:function(a){while(!!a){for(var b=0;b<this.data.TabViews.length;b++){if(!!a.id&&a.id==this.data.TabViews[b].TabId){return this.data.TabViews[b]}}a=a.parentNode}return null},_setViewState:function(b,a){var d=this.data.TabViews[a];var c=document.getElementById(d.TabId);var e=document.getElementById(d.ViewId);c.className=this.State.getCssClass(d.CssClassTag,b);if(!$M.isNull(e)){e.style.display=(a==this.data.ActiveViewIndex)?"":"none"}},setViewUnable:function(a){if(!this.data.TabViews[a]){return false}if(this.data.TabViews[a].Unable){return false}this._setViewState(this.State.Unable,a);this.data.TabViews[a].Unable=true;this._boxJsonData()},setViewEnable:function(a){if(!this.data.TabViews[a]){return false}if(!this.data.TabViews[a].Unable){return false}this._setViewState(this.State.EnableOut,a);this.data.TabViews[a].Unable=false;this._boxJsonData()},setViewActive:function(b){if(!this.data.TabViews[b]){return false}if(this.data.TabViews[b].Unable){return false}if(this.data.ActiveViewIndex==b){return false}var a=this.data.ActiveViewIndex;this.data.ActiveViewIndex=b;this._setViewState(this.State.EnableOut,a);this._setViewState(this.State.Active,b);this._boxJsonData();if(!!this.OnActiveViewChanged){if(this.OnActiveViewChanged(this.data.TabViews[b],b)==false){return false}}},bindEvent:function(){if(this.tabCount==0){return}for(var a=0;a<this.tabCount;a++){var b=$E(this.controlId+"_Tab"+a);Event.observe(b,"mouseover",this._onViewMouseover.bind(this,a));Event.observe(b,"mouseout",this._onViewMouseout.bind(this,a));Event.observe(b,"click",this._onActiveViewChanged.bind(this,a))}},adjustTabWidth:function(){if(this.tabCount==0){return}var b=0;for(var a=0;a<this.tabCount;a++){b+=Element.getDimensions($E(this.controlId+"_Tab"+a)).width}if(this.autoAdjustTabWidth&&b>100){$E(this.controlId+"_Tabs_LiContainer").style.width=(b+50)+"px"}},append:function(d,a){var c=this.controlId+"_Tab"+this.tabCount;var f=this.controlId+"_View"+this.tabCount;if(a=="before"){$($E(this.controlId+"_Tabs_LiContainer")).prepend("<li class='enableout' id='"+c+"'>"+d+"</li>")}else{$($E(this.controlId+"_Tabs_LiContainer")).append("<li class='enableout' id='"+c+"'>"+d+"</li>")}$($E(this.controlId+"_Views")).append("<div id='"+f+"' style='display:none;'></div>");var e={TabId:c,ViewId:f,CssClassTag:"",Unable:false};this.data.TabViews.push(e);var b=$E(c);Event.observe(b,"mouseover",this._onViewMouseover.bind(this,this.tabCount));Event.observe(b,"mouseout",this._onViewMouseout.bind(this,this.tabCount));Event.observe(b,"click",this._onActiveViewChanged.bind(this,this.tabCount));this.tabCount++;this.adjustTabWidth()}};SysApp.Cmn.PagerSetting=Class.create();SysApp.Cmn.PagerSetting.prototype=Object.extend(new SysCmn.CoreInput(),{getPrimaryKey:function(){return"uid"},initCallback:function(){this.showSaveDataSuccessMessage=false;this.instanceString=this.pageInstance;if(this.isEmpty(this.pageListParams)){this.pageListParams=[10,20,50,100]}else{this.pageListParams=this.pageListParams.split(",")}},initInputFormAfter:function(){var b=this;var a='<div class="btn-group-xs">';$.each(this.pageListParams,function(d,e){var c=b.pageSize==e?"btn-primary":"btn-default";a+='<div class="btn '+c+'" onclick= "'+b.selfInstance+'.toggleSelectPage(this)" style="vertical-align: baseline">'+e+"</div>"});a+="&nbsp;<span><b>条/页</b></span></div>";$(this.getDom("divPagerSetting")).append(a)},toggleSelectPage:function(item){this.pageInstance=eval(this.pageInstance);var btnPagerSetting=eval(this.getDom("btnPagerSetting"));$(item).parent()[0].select("div").each(function(element){$(element).attr("class","btn btn-default")});$(item).attr("class","btn btn-primary");var currentPageSize=$.trim($(item).text());this.pageInstance.setPageSize(currentPageSize);this.pageInstance.onClick_Search();this.inputEntity.settingType=3;this.inputEntity.title="每页显示记录条数";this.inputEntity.pageInstance=this.instanceString;if(this.isNotEmpty(this.pageMode)){this.inputEntity.pageInstance=this.instanceString+"_"+this.pageMode}this.inputEntity.parameters=currentPageSize;this.saveData()}});SysApp.Cmn.ProgressModal=Class.create();SysApp.Cmn.ProgressModal.prototype=Object.extend(new SysCmn.CoreInput(),{getPrimaryKey:function(){return"uid"},initCallback:function(){this.bindEvent("btnCloseProgressModal","click",this.closeProgressModal.bind(this));if(this.isEmpty(this.delayTime)){this.delayTime=2000}else{this.delayTime=this.parseInt(this.delayTime)}},closeProgressModal:function(){this.$("progressBar").css("width","0px");this.$("progressBar").text("");this.$("messageContent").css("color","#008BB9");this.$("messageContent").empty();this.hide()},start:function(a,b){this.progressId=a;if(this.isNotEmpty(b)){this.$("ctlTitle").html(b)}this.show();console.log("启动进度："+this.progressId);this.$("messageContent").text("进度信息处理中，请耐心等待。");this.interval=setInterval(this.getProgressDetail.bind(this),this.delayTime)},getProgressDetail:function(){var a={progressId:this.progressId};AjaxIns.sendPOST(this.ajaxUrl+"/detail",this.getProgressDetailCallback.bind(this),a)},getProgressDetailCallback:function(f){var a=f.responseJSON;if(a.result>0){var d=JsonUtility.Parse(a.content);if(this.isEmpty(d.totalNum)){return}var e=this.getDom("progressBar");var c=d.currentNum*100/d.totalNum+"%";$(e).attr("style","min-width: 120px;width: "+c);$(e).text(d.progressText);var b=this.$("messageContent");if(d.messageType==1){b.css("color","#008BB9")}else{if(d.messageType==2){b.css("color","#ED8600")}else{if(d.messageType==3){b.css("color","#E96A59")}}}b.text(d.messageContent);if(d.progressStatus==1&&d.currentNum==0&&d.totalNum==0){$(e).attr("style","min-width: 120px;width: 100%");this.clearInterval()}else{if(d.progressStatus==1){$(e).attr("style","min-width: 120px;width: 100%");this.clearInterval()}}}else{this.clearInterval();this.showErrorMessage(a.message)}},clearInterval:function(){clearInterval(this.interval);this.removeProgress()},removeProgress:function(){if(this.isEmpty(this.progressId)){return}var a={progressId:this.progressId};AjaxIns.sendPOST(this.ajaxUrl+"/removeProgress",this.removeProgressCallback.bind(this),a)},removeProgressCallback:function(b){var a=b.responseJSON;if(a.result>0){console.log("移除进度："+this.progressId)}else{this.showErrorMessage(a.message)}}});SysApp.Cmn.SearchSetting=Class.create();SysApp.Cmn.SearchSetting.prototype=Object.extend(new SysCmn.CoreInput(),{getPrimaryKey:function(){return"uid"},initCallback:function(){this.instanceString=this.pageInstance;this.showSaveDataSuccessMessage=false;this.setValue("pageInstance",this.pageInstance);if(this.isNotEmpty(this.width)){$(this.getFrame()).css("width",this.width)}this.searchIndex=1;this.saveConfirmMessage="确定要将当前设定作为默认检索条件吗？"},customSaveDataCallback:function(a){if(this.isEmpty(this.inputEntity.uid)){this.inputEntity.uid=a.pk}var b=this.pageInstance.getJsonSearchSetting();b[this.searchIndex-1]=this.inputEntity;this.pageInstance.initSearchSetting()},initInputFormBefore:function(){},initInputFormAfter:function(){this.$("ctlTitle").html("检索条件自定义设定");this.pageInstance=eval(this.pageInstance);var pageInstance=this.pageInstance;var thisObj=this;var mainForm=pageInstance.getDom("MainForm");var searchList={};$.each(mainForm.select(".popovers > button"),function(index,button){var container=pageInstance.getDom($(button).data("container"));$.each(container.select("input[type='text'], select"),function(index,item){if(pageInstance.isSearchCondition(item)){if($(item).data("title")){searchList[$(item).attr("id")]={title:$(item).data("title"),label:$.trim($(button).text())}}}})});$.each(mainForm.select("input[type='text'], select"),function(index,item){if(pageInstance.isSearchCondition(item)){if($(item).data("title")&&!searchList[$(item).attr("id")]){searchList[$(item).attr("id")]={title:$(item).data("title"),label:""}}}});var searchSettingList=$(this.getDom("searchSettingList"))[0];$(this.getDom("searchSettingList")).empty();$.each(searchList,function(colName,colInfo){var checked="";var disabled="";if(thisObj.$(colName).data("required")==true){checked=' checked="true"';disabled=' disabled="true"'}var html='<div style="width:180px;float: left;text-overflow:ellipsis;overflow: hidden;"><input class="search-setting-list" id="search_'+colName+'" type="checkbox"'+checked+disabled+'/><label for="search_'+colName+'">'+colInfo.title+"</label></div>";if(searchSettingList.select(".screen-title > :contains(基本查询)").length==0){var baseHtml='<div class="screen-title"><h4 onclick="'+thisObj.selfInstance+'.toggleInputCheck(this)">基本查询</h4><span></span></div><div class="screen-content clearfix"></div>';$(searchSettingList).append(baseHtml)}var targetDom;if(thisObj.isEmpty(colInfo.label)){targetDom=$(searchSettingList.select(".screen-title >:contains(基本查询)")).parent().next()}else{if(searchSettingList.select(".screen-title > :contains("+colInfo.label+")").length==0){var extHtml='<div class="screen-title"><h4 onclick="'+thisObj.selfInstance+'.toggleInputCheck(this)">'+colInfo.label+'</h4><span></span></div><div class="screen-content clearfix"></div>';$(searchSettingList).append(extHtml)}targetDom=$(searchSettingList.select(".screen-title > :contains("+colInfo.label+")")).parent().next()}targetDom.append(html)});this.drawCheckAll();this.changeSearchSetting(this.searchIndex)},toggleInputCheck:function(a){a.parentNode.nextElementSibling.select("input").each(function(b){if(b.disabled){return}b.checked=!b.checked})},drawSearchConditionTitle:function(){$(this.getDom("searchConditionTitle")).empty();var c=this.pageInstance.getJsonSearchSetting();for(var b=0;b<5;b++){if(this.isNull(c[b])){c[b]=new Object()}if(this.isNull(c[b].settingTitle)){c[b].settingTitle="自定义检索条件"+(b+1)}var a=(this.searchIndex==b+1)?"active":"";$(this.getDom("searchConditionTitle")).append('<li class="'+a+'"><a href="#" onclick="'+this.selfInstance+".changeSearchSetting("+(b+1)+')">'+c[b].settingTitle+"</a></li>")}},drawCheckAll:function(){this.bindEvent("checkAll","click",function(){var a=this.checked;$(".search-setting-list").each(function(){if(this.disabled){return}this.checked=a})})},autoChecked:function(){var a=JsonUtility.Parse(this.inputEntity.parameters);$(".search-setting-list").each(function(b,c){if(c.disabled){return}$(c).prop("checked",false);$.each(a,function(e,d){if(d==$(c).attr("id")){$(c).prop("checked",true)}})})},changeSearchSetting:function(b){this.searchIndex=b;var a=this.pageInstance.getJsonSearchSetting();this.drawSearchConditionTitle();this.inputEntity=a[this.searchIndex-1];this.setValue("settingTitle",this.inputEntity.settingTitle||"自定义检索条件"+this.searchIndex);this.autoChecked()},customInputEntity:function(){this.inputEntity.pageInstance=this.getValue("pageInstance");this.inputEntity.settingTitle=this.getValue("settingTitle");this.inputEntity.settingType="2";var a=[];$(".search-setting-list").each(function(){if(this.checked){a.push(this.id)}});this.inputEntity.parameters=JSON.stringify(a);if(this.isNotEmpty(this.pageMode)){this.inputEntity.pageInstance=this.instanceString+"_"+this.pageMode}return this.inputEntity},validateFormBefore:function(){var a=false;$(".search-setting-list").each(function(){if(this.checked){a=true}});if(a==false){this.showErrorMessage("请至少选择一个检索条件进行设置。");return false}return true},customRequestParams:function(){return""}});SysApp.Cmn.BlockSetting=Class.create();SysApp.Cmn.BlockSetting.prototype=Object.extend(new SysCmn.CoreInput(),{getPrimaryKey:function(){return"uid"},initCallback:function(){this.instanceString=this.pageInstance;this.showSaveDataSuccessMessage=false;this.setValue("pageInstance",this.pageInstance);if(this.isNotEmpty(this.width)){$(this.getFrame()).css("width",this.width)}if(self!=top){this.popupPosition="firstTop";SysCmn.CmnMsg.popupPosition="top"}this.saveConfirmMessage="确定要保存当前设定吗？"},customSaveDataCallback:function(a){location.reload()},drawBlock:function(){var c=JsonUtility.Parse(this.inputEntity.parameters);for(var a=0;a<c.length;a++){var b=c[a];this.pageInstance.displayDom(b.id,b.checked);this.pageInstance.displayDom(b.id+"Li",b.checked)}},initInputFormBefore:function(){},initInputFormAfter:function(){this.$("ctlTitle").html("区块自定义显示/隐藏设定");this.pageInstance=eval(this.pageInstance);var blockSetting=this.pageInstance.getValue("jsonBlockSetting");if(this.isNotEmpty(blockSetting)){this.inputEntity=JsonUtility.Parse(blockSetting)[0];this.drawBlock()}$(this.getDom("settingTable")).empty();this.customerTable();$('[name="status"]').bootstrapSwitch({onText:"显示",offText:"隐藏",onColor:"success",offColor:"default",size:"small"})},customerTable:function(){var a='<tr><th width="5%">序号</th><th width="30%">功能模块名称</th><th width="50%">功能模块描述</th><th width="15%">显示/隐藏设置</th></tr>';var b=1;var c=this;$("div[id^='divBlock']").each(function(){a+='<tr><td style="text-align: center;line-height: 30px;">'+b+'</td><td style="line-height: 30px;">'+c.$(this.id).data("title")+'</td><td style="line-height: 30px;">'+c.$(this.id).data("content")+"</td>";if(c.isNull(c.inputEntity)||c.isEmpty(c.inputEntity.uid)){a+='<td style="text-align: center"><input name="status" checked="true" type="checkbox" id='+this.id+' data-size="small"></td>'}else{var e=false;var g=JsonUtility.Parse(c.inputEntity.parameters);for(var d=0;d<g.length;d++){var f=g[d];if(f.id==this.id){e=true;if(f.checked){a+='<td style="text-align: center"><input name="status" checked="true" type="checkbox" id='+this.id+' data-size="small"></td>'}else{a+='<td style="text-align: center"><input name="status" type="checkbox" id='+this.id+' data-size="small"></td>'}}}if(!e){a+='<td style="text-align: center"><input name="status" checked="true" type="checkbox" id='+this.id+' data-size="small"></td>'}}a+="</tr>";b++});this.$("settingTable").append(a)},customInputEntity:function(){this.inputEntity.pageInstance=this.getValue("pageInstance");this.inputEntity.settingType=this.settingType;var a=[];$("input[id^='divBlock']").each(function(){var b={id:this.id,checked:this.checked};a.push(b)});this.inputEntity.parameters=JSON.stringify(a);if(this.isNotEmpty(this.pageMode)){this.inputEntity.pageInstance=this.instanceString+"_"+this.pageMode}return this.inputEntity},validateFormBefore:function(){return true},customRequestParams:function(){return""}});SysApp.Cmn.TimeSelect=Class.create();SysApp.Cmn.TimeSelect.prototype=Object.extend(new SysCmn.Core(),{initialize:function(){this.initCommonProperty()},init:function(){if(this.showHour){this.appendOption(this.getHourDomId(),"","时");for(var a=this.fromHour;a<=this.toHour;){var b=a;if(a<10){b="0"+a}this.appendOption(this.getHourDomId(),b,b);a=a+this.stepHour}}if(this.showMinute){this.appendOption(this.getMinuteDomId(),"","分");for(var a=this.fromMinute;a<=this.toMinute;){var b=a;if(a<10){b="0"+a}this.appendOption(this.getMinuteDomId(),b,b);a=a+this.stepMinute}}},getHourDomId:function(){return this.id+"Hour"},getMinuteDomId:function(){return this.id+"Minute"},setSelectedValue:function(a){var b=[];if(this.isNotEmpty(a)&&a.length==5&&a.indexOf(":")==2){b=a.split(":")}else{if(this.isNotEmpty(a)&&a.length>5&&a.indexOf(" ")>0){a=a.split(" ")[1].substr(0,5);b=a.split(":")}}if(b.length==2){this.setValue(this.getHourDomId(),b[0]);this.setValue(this.getMinuteDomId(),b[1])}else{this.setValue(this.getHourDomId(),"");this.setValue(this.getMinuteDomId(),"")}},getSelectedValue:function(a){if(this.isEmpty(a)){a=false}var b=this.getValue(this.getHourDomId());var c=this.getValue(this.getMinuteDomId());if(this.isEmpty(b)){b=a?"23":"00"}if(this.isEmpty(c)){c=a?"59":"00"}var d=a?"59":"00";return b+":"+c+":"+d},enabled:function(a){this.disabledDom(this.getHourDomId(),!a);this.disabledDom(this.getMinuteDomId(),!a)}});SysApp.Cmn.TreeView=Class.create();SysApp.Cmn.TreeView.prototype=Object.extend(new SysCmn.Core(),{initialize:function(){this.initCommonProperty();this.initCalendarFlag=false},initParentInstance:function(){this._initParentInstance();this.parentInterval=setInterval(this._initParentInstance.bind(this),10)},_initParentInstance:function(){if(this.isNotNull(eval(this.parentInstanceString))){clearInterval(this.parentInterval);this.parentInstance=eval(this.parentInstanceString);eval(this.parentInstanceString+"."+this.treeId+"Tree = this;");this.initTree()}},getTreeId:function(){return this.getId(this.treeId+"Tree")},initTree:function(b,a){this.readonly=false;if(this.isNotEmpty(a)){this.readonly=a}if(this.isNotEmpty(b)){this.selectedValue=b}$.fn.zTree.init(this.$(this.getTreeId()),{view:{dblClickExpand:false},async:{enable:true,type:"post",dataType:"json",url:this.ajaxUrl,autoParam:[]},data:{key:{name:this.nodeName},simpleData:{enable:true,idKey:this.idKey,pIdKey:this.parentIdKey,rootPid:""}},callback:{beforeClick:this.beforeClick.bind(this),onAsyncSuccess:this.zTreeOnAsyncSuccess.bind(this),onClick:this.onClickTreeNode.bind(this),}},null)},beforeClick:function(a,b){return true},zTreeOnAsyncSuccess:function(a,f,g,d){var h=$.fn.zTree.getZTreeObj(this.getTreeId());var e=h.getNodes();if(e.length>0){h.expandNode(e[0],true,false);var e=e[0].children;for(var b=0,c=e.length;b<c;b++){h.expandNode(e[b],true,false)}}if(this.isNotEmpty(this.selectedValue)){this.selectNodeItem(this.selectedValue)}if(this.isFunction(this.parentInstance.initTreeCallback)){this.parentInstance.initTreeCallback(this)}},onClickTreeNode:function(b,j,k){if(this.readonly){return}var m=$.fn.zTree.getZTreeObj(this.getTreeId());var f=m.getSelectedNodes();var h="";var g="";f.sort(function a(e,i){return e[this.idKey]-i[this.idKey]});for(var c=0,d=f.length;c<d;c++){h+=f[c][this.dispName]+",";g+=f[c][this.idKey]+","}if(h.length>0){h=h.substring(0,h.length-1);g=g.substring(0,g.length-1)}if(this.isFunction(this.parentInstance.onClickTreeNodeCallback)){this.parentInstance.onClickTreeNodeCallback(g,h)}},selectNodeItem:function(d){if(this.isEmpty(d)){return}else{var e=$.fn.zTree.getZTreeObj(this.getTreeId());var c=e.getNodes();if(c.length>0){for(var a=0,b=c.length;a<b;a++){this.selectSpecNode(e,c[a],d)}}}},selectSpecNode:function(g,f,e){if(f.isParent){if(f[this.idKey]==e){var c=f[this.dispName];g.selectNode(f,false,false);return}var d=f.children;for(var a=0,b=d.length;a<b;a++){this.selectSpecNode(g,d[a],e)}}else{if(f[this.idKey]==e){var c=f[this.dispName];g.selectNode(f,false,false);return}return}},reAsyncChildNodes:function(a){var b=$.fn.zTree.getZTreeObj(this.getTreeId());b.reAsyncChildNodes(null,"refresh");this.selectedValue=a}});