function getDataGirdClassUID(c,b,d){var a="tb_"+c.tableId+"_"+b;if($M.isEmpty(d)){return a}return a+"_"+d}function dataGridCellClick(d,c,a){var b=SysCmn.DataGridList[d];if(typeof b.cellOnClickCallback=="function"){b.cellOnClickCallback(b.getRowData(c),c,a)}}function dataGridCheckOne(b){var a=SysCmn.DataGridList[b];a.selectedIndexs=[];$(".dataGridCheckAll_"+b).each(function(){var c=$(this).attr("rowNo");if(this.checked){a.selectedIndexs.push(c)}a.getRowData(c).sysChecked=this.checked});if(typeof a.onCheckedCallback=="function"){a.onCheckedCallback(a.selectedIndexs)}}function dataGridCheckAll(b,c){var a=SysCmn.DataGridList[c];a.selectedIndexs=[];$(".dataGridCheckAll_"+c).each(function(){if(this.disabled==false){this.checked=b.checked}});dataGridCheckOne(c)}var DATATABLE_PADDING_WIDTH=4*2;function reCalcColumnPixelWidth(b){if(b.usePercentWidth){return}for(var d=0;d<b.colList.size();d++){var a=b.colList[d];if(a.originalWidth.indexOf("%")==-1){continue}var c=parseInt($("#"+b.divId).width(),10);if(isNaN(c)){continue}if(b.hasData()&&(b.useCheckOne||b.useCheckAll)){c=c-20-DATATABLE_PADDING_WIDTH}if(b.hasData()&&b.useScroll){c=c-20}if(b.hasData()&&b.useRowNo){c=c-35-DATATABLE_PADDING_WIDTH}var e=(c-DATATABLE_PADDING_WIDTH*b.colList.size()-b.colList.size()-1)*parseInt(a.originalWidth,10)/100;if(isNaN(e)){continue}a.width=(e+4)+"px"}}var targetMousedown=false;var targetResizeable=false;var targetCell;var targetCellWidth=0;var targetHeaderWidth=0;var screenXStart=0;function initDataGridColumnResizeEvent(c){var d=$E(c);var a=d.rows[0].cells;for(var b=0;b<a.length;b++){Event.observe(a[b],"mousedown",datagridOnMouseDown.bind(window,c));Event.observe(a[b],"mousemove",datagridOnMouseMove.bind(window,c))}}function datagridOnMouseDown(c,a){var d=$E(c);if(targetResizeable==true){var b=a||window.event;targetMousedown=true;screenXStart=b.screenX;targetCellWidth=targetCell.offsetWidth;targetHeaderWidth=d.offsetWidth}}function datagridOnMouseMove(e,b){var f=$E(e);var c=b||window.event;var a=c.target||c.srcElement;var d=c.offsetX||(c.clientX-a.getBoundingClientRect().left);if(targetMousedown==true){var h=(targetCellWidth+(c.screenX-screenXStart))+"px";targetCell.style.width=h;f.style.width=(targetHeaderWidth+(c.screenX-screenXStart))+"px"}else{var g=f.rows[0];if(a.offsetWidth-d<=4){targetCell=a;targetResizeable=true;a.style.cursor="col-resize"}else{if(d<=4&&a.cellIndex>0){targetCell=g.cells[a.cellIndex-1];targetResizeable=true;a.style.cursor="col-resize"}else{targetResizeable=false;a.style.cursor="default"}}}}document.onmouseup=function(a){targetResizeable=false;targetMousedown=false};SysCmn.DataGridList=[];var ALIGN_LEFT="left";var ALIGN_CENTER="center";var ALIGN_RIGHT="right";var CAMEL_YES=true;var CAMEL_NO=false;var COL_CAMEL_FLAG="^C";var SORT_YES=true;var SORT_NO=false;var ONLY_FOR_EXPORT=true;SysCmn.DataGrid=function(){this.pager=new SysCmn.DataGridPager();this.dom={};this.data=[];this.clientData={};this.colList={};this.tableHtml=[];this.useRowMouseEvent=true;this.useRowClickEvent=true;this.divId="";this.tableId="";this.headerIns=new SysCmn.DataGridHeader();this.cellCallback=null;this.cellToolTipsCallback=null;this.changePageCallback=null;this.sortDataCallback=null;this.useCheckOne=false;this.showCheckOneCallback=null;this.createCheckboxDisabledCallback=null;this.useCheckAll=true;this.selectedIndex=-1;this.selectedIndexs=[];this.ellipsisAllCol=false;this.ellipsisColList=[];this.tipsColList=[];this.totalColList=[];this.inputColList=[];this.contentNoBr=true;this.sortOne=false;this.useScroll=false;this.cssClass="datatable";this.rowClassCallback=null;this.cellClassCallback=null;this.rowHeightCallback=null;this.rowOnClickCallback=null;this.cellOnClickCallback=null;this.rowCount=0;this.divHeader=null;this.divTable=null;this.divTopPager=null;this.divBottomPager=null;this.showTopPager=true;this.headerHeight="20px";this.useClientSort=false;this.clientSortCallback=null;this.defaultSortColName="";this.defaultSortMode="asc";this.useDefaultSelectedAll=false;this.colSpanCallback=null;this.rowSpanCallback=null;this.isSubsequentCellCallback=null;this.isSubsequentRowCallback=null;this.useClientChangePage=false;this.useRowNo=false;this.showNoDataTable=true;this.resizeLastColumnWidth=true;this.fixedWidth=false;this.tableWidth100Percent=false;this.htmlFilterDiv=null;this.rowNo=1;this.showHeader=true;this.usePercentWidth=false;this.useOddStyle=true;this.headerTextAlignMode="center";this.allowResizeColumnWidth=false;this.useMultiHeader=false;this.multiHeaderLineStep=20};SysCmn.DataGrid.prototype={init:function(d,g,b,a){for(var e=0;e<b.length;e++){var f=b[e];if(f.onlyForExport){b.splice(e,1);e--}}this.divId=d;this.jDiv=$($E(this.divId));var c=this;$("#"+this.divId).unbind("resize");$("#"+this.divId).resize(function(){c.resizeTable()});if(g.content!=null&&g.content.length>0){this.data=g.content;this.clientData=this.data;this.pager.init(this,g)}else{this.clientData=g;if(this.useClientChangePage){var h={};h.pageCount=Math.ceil(parseFloat(g.length)/this.pager.pageSize);h.recordCount=g.length;this.pager.init(this,h);this.data=g.slice(0,this.pager.pageSize)}else{this.data=g}}if(typeof this.data=="string"){this.data=[]}this.setRowNo();this.rowCount=this.clientData.length;this.colList=b;this.headerIns.init(this,b);this.cellCallback=a;this.tableId=this.getTableId(this.divId);this.tableHeaderId="header_table_"+this.tableId;SysCmn.DataGridList[this.tableId]=this;if(this.defaultSortColName!=""){this.headerIns.sortColName=this.defaultSortColName;this.headerIns.sortMode=this.defaultSortMode;this.data.sort(this.headerIns.sortJson.bind(this.headerIns))}reCalcColumnPixelWidth(this)},showLoadingMessage:function(a){if($M.isEmpty(a)){a="列表数据加载中......"}if(!$M.isNull(this.divTable)){this.divTable.innerHTML="<img src='"+window.contextPath+"/static/images/base/loading.gif' style='width: 32px;'>&nbsp;<span>"+a+"</span>"}},setRowNo:function(){for(var a=0;a<this.clientData.length;a++){this.clientData[a].sysRowNo=a;this.clientData[a].isTotalRow=false}},getTableId:function(a){return a+"_grid"},getCellSpaceImage:function(){return"<img border=0 src='"+window.imagesPath+"base/spacer.gif'/>"},setPageSize:function(a){this.pager.setPageSize(a)},resetPageNum:function(){this.pager.pageNum=1},changeShowPageNum:function(a){this.pager.changeShowPageNum(a)},getTableWidth:function(){var d=0;for(var b=0;b<this.colList.size();b++){var a=this.colList[b];var c=parseInt(a.width,10)+DATATABLE_PADDING_WIDTH;d+=isNaN(c)?100:c}d=d+this.colList.length+1;if(this.useCheckOne){d+=20+DATATABLE_PADDING_WIDTH}return d},createDiv:function(){if(this.divTable==null){$E(this.divId).innerHTML="";if(this.showTopPager&&this.divTopPager==null){this.divTopPager=document.createElement("div");$E(this.divId).appendChild(this.divTopPager);$(this.divTopPager).hide();$(this.divTopPager).css("margin-top","-10px")}this.divHeader=document.createElement("div");$E(this.divId).appendChild(this.divHeader);this.jHeader=$(this.divHeader);this.divTable=document.createElement("div");$E(this.divId).appendChild(this.divTable);this.jTable=$(this.divTable);if(this.divBottomPager==null){this.divBottomPager=document.createElement("div");$(this.divBottomPager).hide();$E(this.divId).appendChild(this.divBottomPager)}}},clearDataGrid:function(){if(!$M.isNull(this.jTable)){this.jTable.html("")}},resetHeight:function(){if(this.useScroll&&this.hasData()){if(Element.getDimensions($E(this.tableId)).height+Element.getDimensions($E(this.tableHeaderId)).height<Element.getDimensions($E(this.divId)).height){return}this.jTable.css("width","100%");this.jTable.css("overflow-y","auto");this.jTable.css("overflow-x","hidden")}try{this.jTable.height(Element.getDimensions($E(this.divId)).height-parseInt(this.headerHeight,10)-10)}catch(a){var b=parseInt(Element.getDimensions($E(this.divId)).height,10);if(b<=0&&isNaN(b)){return}b=(b-parseInt(this.headerHeight,10)-10);if(b<=0){return}this.jTable.css("height",(b-parseInt(this.headerHeight,10)-10))}},createHeader:function(){if(this.useScroll&&this.hasData()){this.jHeader.show();this.jHeader.html(this.headerIns.create())}else{this.jHeader.html("");this.jHeader.hide()}},createPager:function(a){if(!$M.isNull(a)){this._createPager(a);return}if(this.showTopPager){if(this.pager.pageSize>10){this._createPager(this.divTopPager)}else{var b=$($E(this.divTopPager));b.html("");b.hide()}}this._createPager(this.divBottomPager)},_createPager:function(a){if($M.isEmpty(a)||$M.isNull($E(a))){return}var c=$($E(a));if(this.hasData()){var b=this.pager.create();c.html(b);if($M.isEmpty(b)){c.hide()}else{c.show()}}else{c.html("");c.hide()}},initGridValue:function(){this.selectedIndex=-1;this.selectedIndexs=[];this.jDiv.css("clear","both");this.tableHtml=[]},createBody:function(){if(this.useScroll&&this.jTable.attr("scrollheight")!=null){this.jTable.height(this.jTable.attr("scrollheight"))}this.divTable.scrollTop="0px";var b="";if(!this.hasData()||!this.useScroll){if(!this.fixedWidth){b=" width='100%' ";this.tableWidth100Percent=true}}this.tableHtml.push("<table "+b+" id='"+this.tableId+"' border='0' cellpadding='0' cellspacing='0' class='"+this.cssClass+"'><tbody>");if(this.hasData()){if(!this.useScroll){this.tableHtml.push(this.headerIns.create())}this.createAllRow()}else{this.tableHtml.push(this.headerIns.create());var a=this.colList.length;this.tableHtml.push("<tr><td colspan='"+a+"'><div class='message-nodata'>没有相关数据。<div></td></tr>")}this.tableHtml.push("</tbody></table>");this.divTable.innerHTML=this.tableHtml.join("");if(this.useOddStyle){$("#"+this.tableId+" tr:nth-child(odd)").each(function(){$(this).addClass("odd");$(this).attr("is_odd",1)})}if(this.hasData()){this.setEventAndStyle()}this.resetWidthAndHeight();this.setFirstColumnClass()},setFirstColumnClass:function(a){if($M.isEmpty(a)){a=this.tableId}$("#"+a+" tr").each(function(){$(this).children("th:first").addClass("first-td-border");$(this).children("td:first").addClass("first-td-border")});if(this.useScroll&&this.hasData()){$("#header_table_"+a+" tr").each(function(){$(this).children("th:first").addClass("first-td-border")})}},setEventAndStyle:function(){if(this.useRowMouseEvent){this.setRowMouseMoveEvent()}else{this.setRowStyle()}this.setRowClickEvent()},resetWidthAndHeight:function(){if(this.useScroll&&Element.getDimensions($E(this.tableId)).height<Element.getDimensions(this.divTable).height){this.resetLastColumnWidth();this.jTable.attr("scrollheight",this.jTable.height());this.jTable.height((Element.getDimensions($E(this.tableId)).height+4))}if(!this.useScroll){this.resetLastColumnWidth()}},resetLastColumnWidth:function(){if(this.resizeLastColumnWidth==false||this.useScroll==true){return}this._resetLastColumnWidth();window.setTimeout(this._resetLastColumnWidth.bind(this),1)},_resetLastColumnWidth:function(){var a=($("#"+this.divId).width()-$("#"+this.tableId).width());if(this.tableWidth100Percent&&a>=0){return}var b=$("#"+this.divId+" .tb-last-column");var c=b.width();b.css("width",c+a)},create:function(){this.rowNo=1;if(!this.showNoDataTable&&!this.hasData()){return}this.initGridValue();this.createDiv();this.createHeader();this.createBody();this.createTotalRow();this.createPager();if(this.useScroll&&this.hasData()){this.resetHeight()}dataGridCheckOne(this.tableId)},setRowStyle:function(){$("#"+this.tableId+" tr:gt(0)").css("cursor","pointer")},createAllRow:function(){var b=this.data.length;for(var a=0;a<b;a++){if(this.useMultiHeader){if(a>0&&(a%this.multiHeaderLineStep)==0&&(b-a)>5){this.tableHtml.push(this.headerIns.create())}}this.tableHtml.push(this.createRow(this.data[a],this.data[a].sysRowNo))}},getRowNo:function(a){if(a>=(this.pager.pageNum-1)*this.pager.pageSize){a=a-(this.pager.pageNum-1)*this.pager.pageSize}return(((this.pager.pageNum-1)*this.pager.pageSize)+a+1)},createRow:function(b,c){if(typeof this.createRowCallback=="function"){if(this.createRowCallback(b,c)==false){return""}}var e=b.isTotalRow==true?" total-row ":"";var a=b.isTotalRow==true?"isTotalRow='true'":"";var d="<tr "+a+" rowNo='"+c+"' class='table-default-row "+getDataGirdClassUID(this,c)+e+"' >";d+=this.createCell(b,c);return d+"</tr>"},createTotalRow:function(){if(this.totalColList.size()>0&&this.hasData()){var c=this;var d={};d.isTotalRow=true;$.each(this.totalColList,function(f,e){d[e]=c.getTotal(e)});for(var b=0;b<this.colList.size();b++){var a=this.colList[b];if($.inArray(a.colName,this.totalColList)==-1){d[a.colName]=""}}d.sysRowNo=0;$("#"+this.tableId).append(this.createRow(d,d.sysRowNo))}},createCheckboxCell:function(e,f,d){var b="";if(this.useCheckOne){var c=false;if(typeof this.createCheckboxDisabledCallback=="function"){c=this.createCheckboxDisabledCallback(e)}if(c){c="disabled"}var a="";if(e.sysChecked){a=" checked "}if(typeof this.createCheckboxCallback=="function"){if(this.createCheckboxCallback(e)){a=" checked "}}if(this.useDefaultSelectedAll){a=" checked "}var g=true;if(typeof this.showCheckOneCallback=="function"){g=this.showCheckOneCallback(e)}b="<td class='"+d+"' align='center'><div class='tb-cell-content table-cell-20px'>";if(g&&e.isTotalRow!=true){b+="<input "+a+c+" class='dataGridCheckAll_"+this.tableId+"' type='checkbox' rowNo='"+f+"' onclick=\"dataGridCheckOne('"+this.tableId+"')\"/>"}b+="<div></td>"}return b},getRowCssClass:function(b,c){var a="";if(typeof this.rowClassCallback=="function"){a=this.rowClassCallback(b,c)}return a},createCell:function(p,r){var o=this.getRowCssClass(p,r);var u=this.createCheckboxCell(p,r,o);if(this.useRowNo){var t=this.getRowNo(r);var B="35px";if(t>=10000){B="50px"}if(typeof this.rowNoCallback=="function"){t=this.rowNoCallback(p,r)}var c=o;if(p.isTotalRow==true){t=""}u+="<td nowrap align='center' width='"+B+"' class='"+c+"'>"+t+"</td>"}var q="20px";if(typeof this.rowHeightCallback=="function"){q=this.rowHeightCallback(p)}for(var i=0;i<this.colList.size();i++){var d=this.colList[i];var a=d.cellAlign;var n=p[d.colName];if(!$M.isEmpty(d.subCol)){if($M.isNull(d.index)){n=p[d.subCol][d.colName]}else{n=p[d.subCol][d.index][d.colName]}}var A=n;if(typeof this.cellCallback=="function"){try{if(p.isTotalRow==true){if($.inArray(d.colName,this.totalColList)!=-1){A=this.cellCallback(p,d.colName,r,d)}}else{A=this.cellCallback(p,d.colName,r,d)}}catch(g){console.warn(g.message+"(colName:"+d.colName+")")}}else{if(typeof A=="string"){A=A.escapeHTML()}}if(typeof A=="string"){A=A.stripScripts()}if($M.isNull(this.htmlFilterDiv)){this.htmlFilterDiv=document.createElement("div")}$(this.htmlFilterDiv).html(A);var y=$(this.htmlFilterDiv).text();if(typeof this.cellToolTipsCallback=="function"){y=this.cellToolTipsCallback(p,d.colName,r)}var A=(A==null||$.trim(A.toString())=="")?this.getCellSpaceImage():A;var b=o;if(typeof this.cellClassCallback=="function"){var v=this.cellClassCallback(p,d.colName,d);if(!$M.isEmpty(v)){b=v}}var f=1;if(typeof this.colSpanCallback=="function"){f=this.colSpanCallback(p,d.colName,r)}if($M.isNull(f)){f=1}var s=1;if(typeof this.rowSpanCallback=="function"){s=this.rowSpanCallback(p,d.colName,r)}if($M.isNull(s)){s=1}var C=parseInt(d.width,10);if(f>1){for(var l=i+1;l<i+f;l++){C+=parseInt(this.colList[l].width,10)+DATATABLE_PADDING_WIDTH+1}}C=C+"px";if(typeof this.isSubsequentCellCallback=="function"){if(this.isSubsequentCellCallback(p,d.colName,r)){continue}}if(typeof this.isSubsequentRowCallback=="function"){if(this.isSubsequentRowCallback(p,d.colName,r)){continue}}var m="";if(i==this.colList.size()-1){m=" tb-last-column"}if($M.isNull(y)||d.colName=="operation"){y=""}if(y.length>256){y=y.substring(0,256)}var x="";if((this.ellipsisAllCol&&d.colName!="operation"&&$.inArray(d.colName,this.totalColList)==-1)||$.inArray(d.colName,this.ellipsisColList)!=-1){if(this.contentNoBr){A="<NOBR>"+A+"</NOBR>"}x=" text-overflow:ellipsis"}var z="";if((this.ellipsisAllCol&&d.colName!="operation"&&$.inArray(d.colName,this.totalColList)==-1)||$.inArray(d.colName,this.ellipsisColList)!=-1){if(!$M.isEmpty(y)){z=" title='"+y.escapeHTML()+"'"}}if($.inArray(d.colName,this.tipsColList)!=-1){if(!$M.isEmpty(y)){z=" title='"+y.escapeHTML()+"'"}}if(p.isTotalRow&&$.inArray(d.colName,this.totalColList)!=-1){b+=" total-cell"}var h=p.isTotalRow==true?"is_total_cell='true'":"";if(this.usePercentWidth){u+="<td width='"+d.width+"' "+h+" colspan="+f+" rowspan="+s+" height="+q+"      onclick=\"dataGridCellClick('"+this.tableId+"', "+r+", '"+d.colName+"');\"       class='"+getDataGirdClassUID(this,d.colName)+" "+b+"' align='"+a+"' "+z+">"+A+"</td>"}else{if(this.allowResizeColumnWidth){}if($.inArray(d.colName,this.inputColList)==-1){u+="<td "+h+" colspan="+f+" rowspan="+s+" height="+q+"      onclick=\"dataGridCellClick('"+this.tableId+"', "+r+", '"+d.colName+"');\"       class='"+getDataGirdClassUID(this,d.colName)+" "+b+"' align='"+a+"' "+z+">      <div class='tb-cell-content"+m+"' style='width: "+C+"; overflow: hidden; "+x+"'>"+A+"</div></td>"}else{u+="<td "+h+" colspan="+f+" rowspan="+s+" height="+q+"      onclick=\"dataGridCellClick('"+this.tableId+"', "+r+", '"+d.colName+"');\"       class='"+getDataGirdClassUID(this,d.colName)+" "+b+"' align='"+a+"' "+z+">      <div class='tb-cell-content"+m+"' style='width: "+C+";'>"+A+"</div></td>"}}}return u},createTotalCell:function(){var c="";if(this.useCheckOne){c+="<td style='border:#FFFFFF;' align='center'></td>"}if(this.useRowNo){c+="<td style='border:#FFFFFF;' align='center'></td>"}for(var b=0;b<this.colList.size();b++){var a=this.colList[b];if($.inArray(a.colName,this.totalColList)!=-1){c+="<td align='right' style='border:#FFFFFF;font-weight:bold;'><div class='"+getDataGirdClassUID(this,"totalCol",a.colName)+"'>"+this.getTotal(a.colName)+"<div></td>"}else{c+="<td align='right' style='border:#FFFFFF;'></td>"}}return c},getTotal:function(a){var c=0;if(this.hasData()){for(var b=0;b<this.data.length;b++){var d=parseFloat(this.data[b][a]);c+=isNaN(d)?0:d}}return c},setRowMouseMoveEvent:function(){var a="#"+this.tableId+" tr";$(a).unbind("mouseover");$(a).unbind("mouseout");$(a).bind("mouseover mouseout",function(){if($M.isEmpty($(this).attr("selected"))){if($(this).attr("is_odd")==1){$(this).toggleClass("odd")}$(this).toggleClass("table-mouseover-row")}})},setRowClickEvent:function(){var a=this;var b="#"+this.tableId+" tr";$(b).unbind("click");$(b).click(function(){var d=$(this).attr("rowNo");if($M.isEmpty(d)){return}if(!a.useCheckOne){if(a.selectedIndex==d){a.selectedIndex=-1}else{a.selectedIndex=d}}if(typeof a.rowOnClickCallback=="function"){a.rowOnClickCallback(a.getRowData(d),d)}if(!a.useRowClickEvent){return}if(a.useCheckOne){return}var c=false;if($(this).attr("selected")=="selected"){$(this).removeAttr("selected");c=true;Element.removeClassName(this,"table-selected-row");Element.removeClassName(this,"table-mouseover-row")}else{$(b).each(function(){if($(this).attr("selected")=="selected"){Element.removeClassName(this,"table-selected-row");Element.removeClassName(this,"table-mouseover-row")}});$(b).removeAttr("selected")}if(!c){Element.removeClassName(this,"table-mouseover-row");Element.addClassName(this,"table-selected-row");$(this).attr("selected","selected").end()}})},getConditionJson:function(){return"pagerJson="+this.getConditionString()},getConditionString:function(){var a=this.headerIns.sortColName;if(this.headerIns.camelFlag){a+=COL_CAMEL_FLAG}return'{ "sortColumn": "'+a+'", "sortMode":"'+this.headerIns.sortMode+'", "pageSize": "'+this.pager.pageSize+'", "pageNum":"'+this.pager.pageNum+'"}'},hideColumn:function(a){if(typeof a=="string"){$("."+getDataGirdClassUID(this,a)).hide()}else{if(typeof a=="object"){var b=this;$.each(a,function(c,d){$("."+getDataGirdClassUID(b,d)).hide()})}}},showColumn:function(a){if(typeof a=="string"){$("."+getDataGirdClassUID(this,a)).show()}else{if(typeof a=="object"){var b=this;$.each(a,function(c,d){$("."+getDataGirdClassUID(b,d)).show()})}}},resizeColumn:function(a,b){$("."+getDataGirdClassUID(this,a)+" .tb-cell-content").css("width",b)},addRow:function(c,b,a){if(!this.hasData()){c.sysRowNo=this.rowCount;this.data.push(c);this.create();this.rowCount++;return}this._insertRow(-1,null,c,b,a)},insertRowBefore:function(d,c,b,a){this._insertRow(d,"before",c,b,a)},insertRowAfter:function(d,c,b,a){this._insertRow(d,"after",c,b,a)},_insertRow:function(g,h,f,e,a){f.sysRowNo=this.rowCount;if(!$M.isNull($(".message-nodata"))){$(".message-nodata").remove()}if(g==-1){$("#"+this.tableId).append(this.createRow(f,this.rowCount));this.data.push(f)}else{if(h=="after"){$("."+getDataGirdClassUID(this,g)).after(this.createRow(f,this.rowCount));for(var d=0;d<this.data.length;d++){if(this.data[d].sysRowNo==g){var b=this.data.slice(0,d+1);b.push(f);var c=this.data.slice(d+1);this.data=b.concat(c);break}}}else{if(h=="before"){$("."+getDataGirdClassUID(this,g)).before(this.createRow(f,this.rowCount));for(var d=0;d<this.data.length;d++){if(this.data[d].sysRowNo==g){var b=this.data.slice(0,d);b.push(f);var c=this.data.slice(d);this.data=b.concat(c);break}}}}}this.setEventAndStyle();if(typeof a=="function"){a(f,this.rowCount)}if($M.isEmpty(e)){e="table-list-inserted"}$("."+getDataGirdClassUID(this,this.rowCount)).each(function(){$(this).addClass(e)});this.rowCount++;$("."+getDataGirdClassUID(this,"header_checkbox")).css("display","");this.createTotalRow()},deleteRow:function(c){if(typeof c=="number"){$("."+getDataGirdClassUID(this,c)).remove();for(var b=0;b<this.data.length;b++){if(this.data[b].sysRowNo==c){this.data.splice(b,1)}}}else{if(typeof c=="object"){var a=this;$.each(c,function(e,f){$("."+getDataGirdClassUID(a,f)).remove();for(var d=0;d<a.data.length;d++){if(a.data[d].sysRowNo==f){a.data.splice(d,1);d--}}})}}},hideRow:function(b){if(typeof b=="number"){$("."+getDataGirdClassUID(this,b)).hide()}else{if(typeof b=="object"){var a=this;$.each(b,function(c,d){$("."+getDataGirdClassUID(a,d)).hide()})}}},showRow:function(b){if(typeof b=="number"){$("."+getDataGirdClassUID(this,b)).show()}else{if(typeof b=="object"){var a=this;$.each(b,function(c,d){$("."+getDataGirdClassUID(a,d)).show()})}}},redrawRow:function(c,a){if(typeof c=="number"){$("."+getDataGirdClassUID(this,c)).html(this.createCell(this.getRowData(c),c))}else{if(typeof c=="object"){var b=this;$.each(c,function(d,e){$("."+getDataGirdClassUID(b,e)).html(b.createCell(b.getRowData(e),e))})}}if(typeof a=="function"){a()}},wrapRow:function(c,b,a){this.wrapData(c,b);this.redrawRow(c);this.redrawRow(b);if(typeof a=="function"){a()}},wrapData:function(f,c,a){var e=this.getRowData(f);var b=this.getRowData(c);for(var d=0;d<this.data.length;d++){if(this.data[d].sysRowNo==f){this.data[d]=b;continue}if(this.data[d].sysRowNo==c){this.data[d]=e}}e.sysRowNo=c;b.sysRowNo=f;if(typeof a=="function"){a()}},addClass:function(b,a){$("."+getDataGirdClassUID(this,b)).each(function(){$(this).addClass(a)})},removeClass:function(b,a){$("."+getDataGirdClassUID(this,b)).each(function(){$(this).removeClass(a)})},resizeTable:function(){var b=this;for(var c=0;c<this.colList.size();c++){var a=this.colList[c];$("."+getDataGirdClassUID(b,a.colName)+" .tb-cell-content").css("width",a.width)}if(this.useScroll&&!$M.isNull($E(this.tableId))&&Element.getDimensions($E(this.tableId)).height<=Element.getDimensions(this.divTable).height){this.resetLastColumnWidth()}},getSelectedRow:function(){return this.getRowData(this.selectedIndex)},getSelectedRows:function(){var b=[];for(var a=0;a<this.selectedIndexs.length;a++){b.push(this.getRowData(this.selectedIndexs[a]))}return b},getRowData:function(b){if(b>-1&&this.hasData()){for(var a=0;a<this.data.length;a++){if(this.data[a].sysRowNo==b){return this.data[a]}}}return null},clearCheck:function(){for(var a=0;a<this.data.length;a++){this.data[a].sysChecked=false}this.selectedIndex=-1;this.selectedIndexs=[]},hasData:function(){if(!$M.isNull(this.data)&&!$M.isNull(this.data.length)&&this.data.length>0){return true}return false},setCheckStatus:function(b,c){var a=this;if(typeof b=="number"){$(".dataGridCheckAll_"+a.tableId).each(function(){a._setCheckStatus(this,b,c)})}else{if(typeof b=="object"){$.each(b,function(d,e){$(".dataGridCheckAll_"+a.tableId).each(function(){a._setCheckStatus(this,e,c)})})}}dataGridCheckOne(this.tableId)},_setCheckStatus:function(a,b,c){var d=$(a).attr("rowNo");if(d==b){a.checked=c}}};var ColInfo=function(i,e,j,h,d,g,c){j=new String(j);this.title=i;this.colName=e;this.onlyForExport=g;if($M.isEmpty(this.onlyForExport)){this.onlyForExport=false}this.camelFlag=c;if($M.isEmpty(this.camelFlag)){this.camelFlag=false}if(j.indexOf("%")==-1){if(j.indexOf("px")==-1){this.width=j+"px"}else{this.width=j}}else{this.width=j}this.originalWidth=this.width;this.sortFlag=h;if(d==null||typeof d==undefined){this.cellAlign="left"}else{this.cellAlign=d}this.sortMode="asc";this.originalColName=this.colName;var f=e.indexOf(".");if(f>0){this.colName=this.originalColName.substr(f+1);this.subCol=this.originalColName.substr(0,f);var a=this.subCol.indexOf("[");var b=this.subCol.indexOf("]");if(a>0&&b>0){this.index=parseInt(this.subCol.substr(a+1,(b-a-1)),10);this.subCol=this.subCol.substr(0,a)}}};var PAGE_FIRST="第一页";var PAGE_PREV="上一页";var PAGE_NEXT="下一页";var PAGE_LAST="最末页";SysCmn.DataGridPager=function(){this.dom={};this.params={};this.data=null;this.datagrid=null;this.pageSize=10;this.pageNum=1;this.showPageNum=5;this.showRecordInfo=true};SysCmn.DataGridPager.prototype={init:function(b,a){this.datagrid=b;this.data=a;if(!$M.isEmpty(a.sort)){this.data.sortMode=a.sort[0].direction;this.data.sortColumn=a.sort[0].property}else{this.data.sortMode="desc";this.data.sortColumn="uid"}this.pageSize=a.size;this.pageNum=a.number+1},setPageSize:function(a){this.pageSize=a},changeShowPageNum:function(a){this.showPageNum=a},create:function(){if(this.data==null){return""}if(this.data.pageCount<=1||this.data.totalPages<=1){if(this.showRecordInfo&&this.data.totalElements>10&&!this.datagrid.useScroll){return"<div class='pagination-record-info-no-page'>共 <b>"+this.data.totalElements+"</b> 条记录，当前第 <b>"+this.pageNum+"/"+this.data.totalPages+"</b> 页</div>"}else{return""}}var a=this.pageNum;var d=this.data.totalPages;var b="";if(this.showRecordInfo&&!this.datagrid.useScroll){b="<div class='pagination-record-info'>共 <b>"+this.data.totalElements+"</b> 条记录，当前第 <b>"+this.pageNum+"/"+this.data.totalPages+"</b> 页</div>"}b+="<ul class='pagination'>";b+=this.bindPageProperty(PAGE_FIRST,a,d);b+=this.bindPageProperty(PAGE_PREV,a,d);var f=1;if(d>this.showPageNum){if(a>d-Math.floor(this.showPageNum/2)){f=d-this.showPageNum+1}else{if(a>this.showPageNum-2){f=a-Math.floor(this.showPageNum/2)}}}for(var c=0;c<this.showPageNum;c++){if(d>this.showPageNum&&c==0&&a>3){b+=this.bindPageProperty(1);b+=this.bindPageProperty("...")}if(a!=f){b+=this.bindPageProperty(f)}else{b+=this.bindPageProperty(f,a)}if(c==this.showPageNum-1&&parseInt(a,10)+2<d&&this.showPageNum<d){b+=this.bindPageProperty("...");b+=this.bindPageProperty(d)}if(f++>=d){break}}b+=this.bindPageProperty(PAGE_NEXT,a,d);b+=this.bindPageProperty(PAGE_LAST,a,d);b+="</ul>";if(this.showRecordInfo){if(this.data.totalPages>30){var e="<label>跳转到</label><input onchange=\"return changePagInputNum('"+this.datagrid.tableId+"',this);\" maxlength='5' value='"+this.pageNum+"' data-total-pages='"+this.data.totalPages+"' class='form-control' style='width: 50px;'/><label>页</label>";return b+"<div class='pagination-input-info form-group form-inline'>"+e+"</div>"}else{var g="<select onchange=\"return changePagSelectNum('"+this.datagrid.tableId+"',this);\" class='form-control'>";for(var c=0;c<this.data.totalPages;c++){if(c+1==this.pageNum){g+="<option selected value="+(c+1)+">第 "+(c+1)+" 页</option>"}else{g+="<option value="+(c+1)+">第 "+(c+1)+" 页</option>"}}g+="</select>";return b+"<div class='pagination-select-info form-group form-inline'>"+g+"</div>"}}else{return b}},bindPageProperty:function(c,a,d){var e=c;if(c==PAGE_FIRST){e=1}else{if(c==PAGE_PREV){e=parseInt(this.pageNum,10)-1}else{if(c==PAGE_NEXT){e=parseInt(this.pageNum,10)+1}else{if(c==PAGE_LAST){e=d}}}}var b="<li><a id='"+this.datagrid.tableId+"_pager_"+c+"' ";if(c=="..."||(a==1&&(c==PAGE_FIRST||c==PAGE_PREV))||(a==d&&(c==PAGE_NEXT||c==PAGE_LAST))){b="<li class='disabled'><a id='"+this.datagrid.tableId+"_pager_"+c+"'>"}else{if(a==c){b="<li class='active'><a id='"+this.datagrid.tableId+"_pager_"+c+"'>"}else{b+="href='#' onclick=\"return changePageNum('"+this.datagrid.tableId+"','"+e+"');\">"}}b+=c;b+="</a></li>";return b},changePageNum:function(){if(this.datagrid.useClientChangePage){var b=(parseInt(this.pageNum,10)-1)*this.pageSize;var a=parseInt(this.pageNum,10)*this.pageSize;this.datagrid.data=this.datagrid.clientData.slice(b,a);this.datagrid.create();return}if(typeof this.datagrid.changePageCallback=="function"){this.datagrid.changePageCallback()}}};function changePageNum(c,b){var a=SysCmn.DataGridList[c];a.pager.pageNum=b;a.pager.changePageNum();return false}function changePagSelectNum(b,a){return changePageNum(b,$(a).val())}function changePagInputNum(c,a){var b=parseInt($(a).val(),10);var d=$(a).data("total-pages");if(b>=1&&b<=d){return changePageNum(c,b)}SysCmn.CmnMsg.showMessage("页码输入错误（请输入1-"+d+"之间的页码）。",MSG_TYPE_ERROR);return false}SysCmn.DataGridHeader=function(){this.chkFlag=true;this.datagrid=null;this.colList={};this.sortColName="";this.sortMode="asc";this.camelFlag=false};SysCmn.DataGridHeader.prototype={init:function(b,a){this.datagrid=b;this.colList=a;if(!$M.isNull(b.pager)&&!$M.isNull(b.pager.data)){this.sortColName=b.pager.data.sortColumn;if(this.sortColName.indexOf(COL_CAMEL_FLAG)>0){this.sortColName=this.sortColName.substring(0,this.sortColName.indexOf(COL_CAMEL_FLAG));this.camelFlag=true}this.sortMode=b.pager.data.sortMode.toLowerCase()}},create:function(){var e="";if(typeof this.datagrid.customCreateHeader=="function"){return this.datagrid.customCreateHeader(this.colList)}if(this.datagrid.useCheckOne&&this.datagrid.hasData()){var a=" class='"+getDataGirdClassUID(this.datagrid,"header_checkbox")+"' ";if(this.datagrid.usePercentWidth){e+="<th "+a+" align='center' style='width: 20px; height: "+this.datagrid.headerHeight+"'>"}else{e+="<th "+a+" align='center' style='width: 20px; height: "+this.datagrid.headerHeight+"'>    <div class='tb-cell-content' style='width: 20px;overflow: hidden;'>"}if(this.datagrid.useCheckAll){var b="";if(this.datagrid.useDefaultSelectedAll){b=" checked "}e+="<input type='checkbox' "+b+" onclick=\"dataGridCheckAll(this, '"+this.datagrid.tableId+"');\" />"}else{e+="&nbsp;"}if(this.datagrid.usePercentWidth){e+="</th>"}else{e+="</div></th>"}}if(this.datagrid.useRowNo&&this.datagrid.hasData()){var o="35px";if(this.datagrid.getRowNo(1)>=10000){o="50px"}e+="<th nowrap width='"+o+"'>序号</th>"}for(var g=0;g<this.colList.size();g++){var d=this.colList[g];if(d.title!=""){var c=getDataGirdClassUID(this.datagrid,d.colName);var m="<th nowrap height='"+this.datagrid.headerHeight+"' align='center' class='"+c+"' ";var l=1;var p=parseInt(d.width,10);for(var h=g+1;h<this.colList.size();h++){if(this.colList[h].title==""){l++;p+=parseInt(this.colList[h].width,10);continue}break}if(l>1){p+=(l-1)*DATATABLE_PADDING_WIDTH-(l-1);m+=" colspan='"+l+"' ";m+=" width='"+p+"px'"}else{if(this.datagrid.hasData()){m+=" width='"+p+"px'"}else{if(g<this.colList.size()-1){m+=" width='"+p+"px'"}}}for(var i in d){if(d.colName==this.sortColName){d.sortMode=this.sortMode}if(i=="width"){continue}if(i!="title"){m+=i+"='"+d[i]+"' "}}if(d.sortFlag&&this.datagrid.hasData()){if(this.datagrid.sortOne&&this.sortColName==d.colName){m+=" style='cursor:pointer; text-align:center;' "}else{m+=" style='cursor:pointer; text-align:center;' "}}else{m+=" style='text-align:center;' "}var f=false;if(g==this.colList.length-1){f=true}m+=this.addTitleData(g,d,p,f);m+="</th>";e+=m}}if(this.datagrid.showHeader){e="<tr id='header_tr_"+this.datagrid.tableId+"' tableId='"+this.datagrid.tableId+"'>"+e+"</tr>"}else{e="<tr style='display:none;' id='header_tr_"+this.datagrid.tableId+"' tableId='"+this.datagrid.tableId+"'>"+e+"</tr>"}var n="";if(this.datagrid.useScroll&&this.datagrid.hasData()){e="<table "+n+" id='header_table_"+this.datagrid.tableId+"' border='0' cellpadding='0' cellspacing='0' class='"+this.datagrid.cssClass+"'><tbody>"+e+"</tbody></table>"}return e},addTitleData:function(b,a,i,c){var g=a.title;if(this.datagrid.hasData()){g+=this.addTitleSortImg(a)}var f=a.width;if(i>parseInt(a.width,10)){f=i+"px"}var d="";if(c){d=" tb-last-column"}var e="text-align:center;";if(this.datagrid.headerTextAlignMode=="left"){e="text-align:left;"}else{if(this.datagrid.headerTextAlignMode=="right"){e="text-align:right;"}else{if(this.datagrid.headerTextAlignMode=="autoWithColInfo"){e="text-align:"+a.cellAlign+";"}}}if(!this.datagrid.usePercentWidth){var h=a.title;if(h.indexOf("<")!=-1&&h.indexOf(">")!=-1){h=""}e+="overflow: hidden; text-overflow:ellipsis;";if(this.datagrid.allowResizeColumnWidth){e+="min-width:"+f+";";f="100%"}e+="width:"+f+";";if(a.sortFlag){e+="cursor:pointer;";g="<div onclick=\"sortDataGrid('"+this.datagrid.tableId+"', this, "+a.camelFlag+");\" title='"+h+"' class='tb-cell-content"+d+"' style='"+e+"'><NOBR>"+g+"</NOBR></div>"}else{g='<div title="'+h+"\" class='tb-cell-content"+d+"' style='"+e+"'><NOBR>"+g+"</NOBR></div>"}}return"id='"+this.datagrid.tableId+a.colName+"' colNo='"+b+"' style=' height:"+this.datagrid.headerHeight+";' >"+g},addTitleSortImg:function(a){var b="";if(this.sortColName==a.colName){b+="<img src='"+window.imagesPath+"base/sort_"+this.sortMode+".gif' />"}return b},sortData:function(){if(this.datagrid.useClientSort){if(this.datagrid.useClientChangePage){if(typeof this.customSortJsonData=="function"){this.datagrid.clientData.sort(this.customSortJsonData.bind(this))}else{this.datagrid.clientData.sort(this.sortJson.bind(this))}this.datagrid.data=this.datagrid.clientData.slice(0,this.datagrid.pager.pageSize)}else{if(typeof this.customSortJsonData=="function"){this.datagrid.data.sort(this.customSortJsonData.bind(this))}else{this.datagrid.data.sort(this.sortJson.bind(this))}}this.datagrid.setRowNo();this.datagrid.create();if(typeof this.datagrid.clientSortCallback=="function"){this.datagrid.clientSortCallback()}return}if(typeof this.datagrid.sortDataCallback=="function"){this.datagrid.sortDataCallback()}},sortJson:function(c,d){if(this.sortMode=="asc"){return c[this.sortColName]>d[this.sortColName]?1:c[this.sortColName]==d[this.sortColName]?0:-1}else{return d[this.sortColName]>c[this.sortColName]?1:d[this.sortColName]==c[this.sortColName]?0:-1}}};function sortDataGrid(d,c,a){c=c.parentNode;var b=SysCmn.DataGridList[d];b.headerIns.sortColName=c.id.replaceAll(b.tableId,"");b.headerIns.sortMode=$(c).attr("sortMode").toLowerCase();b.headerIns.camelFlag=a;b.resetPageNum();if(b.headerIns.sortMode==null||b.sortOne){b.headerIns.sortMode="asc";$(c).attr("sortMode",b.headerIns.sortMode)}else{if(b.headerIns.sortMode=="asc"){b.headerIns.sortMode="desc"}else{if(b.headerIns.sortMode=="desc"){b.headerIns.sortMode="asc"}}}b.headerIns.sortData()};